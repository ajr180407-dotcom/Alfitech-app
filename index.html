<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alfitech App Download - F-Droid Otomatis</title>
    
    <!-- Load Tailwind CSS dan Font Awesome -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Firebase Imports (Hanya untuk Analitik, Sesuai Implementasi Sebelumnya) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, serverTimestamp, increment, collection, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        window.Firebase = {
            initializeApp, getAuth, signInAnonymously, signInWithCustomToken, 
            getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, 
            serverTimestamp, increment, collection, setLogLevel
        };
    </script>

    <style>
        /* Variabel Warna Kustom (Dark Mode Permanen untuk UI) */
        :root {
            --primary-bg: #0A0F1D; 
            --secondary-bg: #151A2C; 
            --accent-blue: #00BCD4; 
            --text-light: #E0E7FF; 
            --text-muted: #9CA3AF; 
            --card-border: #1F2937;
            --shadow-color: rgba(0, 0, 0, 0.25);
            --header-height: 8rem; /* ~128px */
        }

        body {
            background-color: var(--primary-bg);
            color: var(--text-light);
            transition: background-color 0.3s, color 0.3s;
            padding-top: var(--header-height); 
            padding-bottom: 5rem;
            font-family: 'Inter', sans-serif;
        }

        /* Gaya Komponen */
        .card-style {
            background-color: var(--secondary-bg);
            border: 1px solid var(--card-border);
            color: var(--text-light);
            box-shadow: 0 4px 10px var(--shadow-color);
        }

        /* --- SKELETON LOADER ANIMATION --- */
        @keyframes pulse {
          0% { opacity: 0.8; }
          50% { opacity: 0.4; }
          100% { opacity: 0.8; }
        }
        .skeleton-pulse {
          animation: pulse 1.5s infinite ease-in-out;
        }
        /* --- END SKELETON LOADER --- */

        /* Logo Animasi */
        @keyframes logo-pulse {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.05) rotate(5deg); opacity: 0.85; }
        }
        .logo-a {
            animation: logo-pulse 3s infinite ease-in-out;
            will-change: transform, opacity;
        }
        .logo-a-color {
            color: var(--accent-blue); 
            border-color: var(--accent-blue); 
            box-shadow: 0 0 15px var(--accent-blue);
        }

        /* Header fixed di atas */
        .fixed-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 20;
            background-color: var(--primary-bg); 
            backdrop-filter: blur(5px);
            border-bottom: 1px solid var(--card-border);
            box-shadow: 0 4px 12px var(--shadow-color); 
            transition: background-color 0.3s, border-color 0.3s, box-shadow 0.3s;
            height: var(--header-height); /* Tinggi tetap */
        }
        
        /* Area Animasi yang Ikut Digulir */
        #landing-area {
            position: relative;
            width: 100%;
            height: calc(100vh - var(--header-height)); 
            overflow: hidden; 
        }
        
        /* Kanvas 3D mengisi landing-area */
        .bg-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -10; 
        }
        
        /* --- FADE IN / LAZY LOAD STYLES --- */
        /* Initial state: Opacity 0 and slight translateY */
        .card-initial-state {
            opacity: 0;
            transform: translateY(15px);
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* Smooth transition */
        }
        /* State when IntersectionObserver adds the class */
        .fade-in { 
            opacity: 1 !important; 
            transform: translateY(0) !important; 
        }
        /* --- END FADE IN --- */


    </style>
</head>
<body>
    
    <!-- HEADER TETAP (FIXED) -->
    <header class="fixed-header"> 
        <div class="max-w-4xl mx-auto px-4 pt-4 pb-3"> 
            
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center text-3xl font-extrabold tracking-tight">
                    <span class="logo-a mr-1 p-1 rounded-lg border-2 shadow-lg logo-a-color">A</span>
                    <span class="text-[var(--text-light)]">Alfitech App</span>
                </div>
                
                <button id="settings-btn" onclick="openSettingsModal()" class="p-2 text-[var(--text-muted)] hover:text-[var(--accent-blue)] transition duration-150 rounded-full card-style">
                    <i class="fas fa-cog text-xl"></i>
                </button>
            </div>
            
            <div class="mb-2"> 
                <input type="text" id="search-input" placeholder="Cari Aplikasi F-Droid..."
                       class="w-full p-3 rounded-xl border focus:ring-[var(--accent-blue)] focus:border-[var(--accent-blue)] shadow-lg transition duration-300 input-style"
                       oninput="handleSearch()">
            </div>
            
            <!-- INDIKATOR SCROLL DI BAWAH SEARCH BOX -->
            <div id="scroll-indicator" class="header-bottom-indicator flex flex-col items-center justify-center w-full py-2 text-[var(--accent-blue)] transition-opacity duration-500">
                <span class="text-xs font-semibold mb-1">Gulir Ke Bawah Untuk Melihat Aplikasi</span>
                <i class="fas fa-chevron-down text-xl animate-bounce-cool"></i>
            </div>
            <!-- AKHIR INDIKATOR SCROLL -->

        </div>
    </header>

    <!-- AREA LANDING YANG IKUT SCROLL BERSAMA KONTEN -->
    <div id="landing-area" class="w-full relative overflow-hidden mb-10">
        <canvas id="bg-canvas" class="bg-canvas"></canvas>
    </div>
    <!-- AKHIR AREA LANDING -->

    
    <div class="max-w-4xl mx-auto px-4">
        <!-- Grid konten F-Droid Apps (Menggunakan grid-cols-2 untuk mobile) -->
        <main id="content-list" class="content-view grid grid-cols-2 sm:grid-cols-4 gap-4 p-1">
            <!-- Content cards will be rendered here -->
        </main>
        
        
        <div id="content-donate-page" class="content-view hidden p-8 text-center mt-10 rounded-xl card-style">
            <i class="fas fa-hand-holding-heart text-5xl mb-4" style="color: var(--accent-blue);"></i>
            <h2 class="text-2xl font-bold mb-4 text-[var(--text-light)]">Ayo Dukung Kami Alfitech App!</h2>
            <p class="text-lg text-[var(--text-light)] text-opacity-80 mb-8">
                Dukungan Anda sangat berarti bagi kami untuk menjaga server tetap berjalan,
                mengembangkan fitur-fitur baru, dan terus memberikan aplikasi terbaik.
            </p>
            
            <p class="text-xl font-bold mb-6 text-[var(--text-light)]">
                Silakan klik disini:
            </p>
            
            <a href="https://trakteer.id/Alfitech_app" target="_blank" onclick="trackDonateClick()"
               class="inline-block px-8 py-4 rounded-full text-xl font-extrabold shadow-2xl transition duration-300 transform hover:scale-105 donasi-link"
               style="background: linear-gradient(45deg, #FF6F00, #FF9800); color: #FFF;">
                <i class="fas fa-money-check-alt mr-2"></i> DONASI SEKARANG
            </a>
            
        </div>
    </div>

    
    <!-- FOOTER/NAVIGASI (Diperbarui hanya ke "Aplikasi" dan "Donasi") -->
    <footer class="fixed bottom-0 left-0 right-0 backdrop-blur-sm border-t z-10" style="background-color: var(--primary-bg); border-color: var(--card-border); box-shadow: 0 -4px 12px var(--shadow-color);">
        <nav class="flex justify-around items-center h-16 max-w-lg mx-auto">
            
            <button id="apps-tab" onclick="switchTab('apps')" class="flex flex-col items-center justify-center p-2 flex-1 text-[var(--accent-blue)] transition duration-200">
                <i class="fas fa-mobile-alt text-xl"></i>
                <span class="text-xs mt-1 font-semibold">Aplikasi F-Droid</span>
            </button>
            
            <button id="donate-tab" onclick="switchTab('donate')" class="flex flex-col items-center justify-center p-2 flex-1 text-[var(--text-muted)] hover:text-[var(--accent-blue)] transition duration-200">
                <i class="fas fa-heart text-xl"></i>
                <span class="text-xs mt-1 font-semibold">Donasi</span>
            </button>
        </nav>
    </footer>

    
    <!-- DETAIL MODAL -->
    <div id="detail-modal" class="hidden fixed inset-0 z-50 overflow-y-auto backdrop-blur-sm bg-gray-900/90 transition-opacity duration-300">
        <div class="modal-content max-w-xl mx-auto my-0 pt-0 pb-20 rounded-xl sm:rounded-b-none min-h-full">
            <button onclick="closeDetails()" class="fixed top-2 left-2 sm:absolute sm:top-4 sm:left-4 p-2 rounded-full transition text-white z-50" style="background-color: rgba(0, 0, 0, 0.5); hover:background-color: rgba(0, 0, 0, 0.7);">
                <i class="fas fa-arrow-left text-lg"></i>
            </button>
            
            <div class="w-full aspect-video rounded-b-lg overflow-hidden mb-4 relative">
                <img id="detail-screenshot" src="" onerror="this.onerror=null;this.src='https://placehold.co/600x338/E5E7EB/6B7280?text=PREVIEW+MEDIA+TIDAK+TERSEDIA';" alt="Screenshot Aplikasi" class="w-full h-full object-cover">
            </div>

            <div class="px-4 sm:px-6">
                <div class="flex items-start mb-6">
                    <!-- Ikon kini diisi oleh img tag (jika ada) atau fallback fa icon -->
                    <div id="detail-icon" class="w-16 h-16 rounded-xl flex items-center justify-center text-3xl text-white shadow-xl flex-shrink-0 p-1" style="background-color: var(--accent-blue);">
                        <i class="fas fa-mobile-alt"></i> 
                    </div>
                    <div class="ml-4 flex-grow">
                        <h2 id="detail-name" class="text-xl font-bold truncate text-[var(--text-light)]">Nama Aplikasi</h2>
                        <p id="detail-category-dev" class="text-xs text-[var(--text-muted)] mt-1">Kategori • Pengembang</p>
                    </div>
                    
                    <a id="detail-download-btn-link" target="_blank" 
                       class="py-2 px-4 rounded-full text-sm font-bold transition duration-200 hover:brightness-110 flex-shrink-0 ml-4 cursor-pointer flex items-center justify-center" 
                       style="background-color: var(--accent-blue); color: var(--secondary-bg);">
                        <i class="fas fa-download mr-1"></i> Unduh APK
                    </a>
                </div>

                
                <div class="flex justify-between items-center text-center py-3 border-y mb-6" style="border-color: var(--card-border);">
                    <div class="flex-1"><div class="text-base font-bold flex items-center justify-center text-[var(--text-light)]"><i class="fas fa-star text-yellow-400 text-sm mr-1"></i><span id="detail-rating">4.5</span></div><p class="text-[10px] text-[var(--text-muted)]">Ulasan</p></div>
                    <div class="w-[1px] h-6" style="background-color: var(--card-border);"></div>
                    <div class="flex-1"><div id="detail-size" class="text-base font-bold text-[var(--text-light)]">0 MB</div><p class="text-[10px] text-[var(--text-muted)]">Ukuran</p></div>
                    <div class="w-[1px] h-6" style="background-color: var(--card-border);"></div>
                    <div class="flex-1"><div id="detail-installs" class="text-base font-bold text-[var(--text-light)]">1M+</div><p class="text-[10px] text-[var(--text-muted)]">Pemasangan</p></div>
                    <div class="w-[1px] h-6" style="background-color: var(--card-border);"></div>
                    <div class="flex-1"><div id="detail-version" class="text-base font-bold text-[var(--text-light)]">1.0</div><p class="text-[10px] text-[var(--text-muted)]">Versi</p></div>
                </div>

                <h3 class="text-lg font-bold mb-3" style="color: var(--accent-blue);">Tentang Aplikasi Ini</h3>
                <p id="detail-description" class="text-[var(--text-light)] text-opacity-80 leading-relaxed text-sm mb-6"></p>

                <h3 class="text-lg font-bold mb-3" style="color: var(--accent-blue);">Pembaruan & Fitur</h3>
                <ul id="detail-features" class="grid grid-cols-1 sm:grid-cols-2 gap-4 list-none p-0 text-sm mb-10">
                    <!-- Features rendered here -->
                </ul>
            </div>
        </div>
    </div>
    
    
    <!-- SETTINGS MODAL (Tidak diubah) -->
    <div id="settings-modal" class="hidden fixed inset-0 z-50 overflow-y-auto backdrop-blur-sm bg-gray-900/90 transition-opacity duration-300">
        <div class="max-w-xl mx-auto my-4 p-4 sm:p-6 rounded-xl shadow-2xl modal-content">
            <div class="flex justify-between items-start mb-4 border-b pb-4" style="border-color: var(--card-border);">
                <h2 class="text-2xl font-bold text-[var(--text-light)]">Pengaturan & Analisis</h2>
                <button onclick="closeSettings()" class="p-2 rounded-full hover:bg-[var(--primary-bg)] transition text-[var(--text-muted)] hover:text-[var(--accent-blue)]">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            
            <div id="settings-tabs" class="flex border-b mb-6" style="border-color: var(--card-border);">
                <button id="tab-analytics" onclick="switchSettingsTab('analytics')" class="p-3 text-sm font-semibold border-b-2 border-transparent transition duration-200">Analisis Website</button>
                <button id="tab-theme" onclick="switchSettingsTab('theme')" class="p-3 text-sm font-semibold border-b-2 border-transparent transition duration-200 text-[var(--text-muted)]">Tampilan</button>
                <button id="tab-about" onclick="switchSettingsTab('about')" class="p-3 text-sm font-semibold border-b-2 border-transparent transition duration-200 text-[var(--text-muted)]">Tentang App</button>
            </div>

            
            <div id="content-analytics" class="tab-content space-y-6">
                <h3 class="text-lg font-bold border-b pb-2" style="border-color: var(--card-border); color: var(--accent-blue);">Statistik Global Website</h3>
                
                <div class="grid grid-cols-3 gap-3 text-center">
                    <div class="p-3 rounded-xl shadow-inner border" style="background-color: var(--primary-bg); border-color: var(--card-border);">
                        <p id="metric-visits" class="text-2xl font-extrabold text-[var(--accent-blue)]">0</p>
                        <p class="text-xs text-[var(--text-muted)]">Kunjungan</p>
                    </div>
                    <div class="p-3 rounded-xl shadow-inner border" style="background-color: var(--primary-bg); border-color: var(--card-border);">
                        <p id="metric-downloads" class="text-2xl font-extrabold text-green-500">0</p>
                        <p class="text-xs text-[var(--text-muted)]">Total Unduhan</p>
                    </div>
                    <div class="p-3 rounded-xl shadow-inner border" style="background-color: var(--primary-bg); border-color: var(--card-border);">
                        <p id="metric-donate-clicks" class="text-2xl font-extrabold text-yellow-500">0</p>
                        <p class="text-xs text-[var(--text-muted)]">Klik Donasi</p>
                    </div>
                </div>
                
                <p class="text-xs text-[var(--text-muted)] pt-2 text-center">Data diperbarui secara real-time dari Firestore.</p>
            </div>
            
            
            <div id="content-theme" class="tab-content hidden space-y-6">
                 <h3 class="text-lg font-bold border-b pb-2" style="border-color: var(--card-border); color: var(--accent-blue);">Pilihan Tampilan Animasi 3D</h3>
                 
                 <div class="flex justify-between items-center p-4 rounded-xl card-style border-none">
                     <span class="text-base font-semibold text-[var(--text-light)]">Gunakan Warna Terang pada Animasi</span>
                     <label class="relative inline-flex items-center cursor-pointer">
                         <input type="checkbox" id="theme-toggle" class="sr-only peer" onchange="toggleTheme()">
                         <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-[var(--accent-blue)]"></div>
                     </label>
                 </div>
                 
                 <p class="text-sm text-[var(--text-muted)] pt-2">Hanya warna objek 3D di latar belakang yang akan berubah. Seluruh tema website akan tetap dalam Mode Gelap.</p>
            </div>
            
            
            <div id="content-about" class="tab-content hidden space-y-4">
                 <h3 class="text-lg font-bold border-b pb-2" style="border-color: var(--card-border); color: var(--accent-blue);">Tentang Alfitech App</h3>
                 <p class="text-sm text-[var(--text-light)]">
                     Alfitech App adalah platform unduhan aplikasi dan game simulasi yang dirancang untuk demonstrasi. 
                     Kami menampilkan berbagai konten fiktif dengan antarmuka yang modern, responsif, dan kaya fitur. 
                     Aplikasi ini dibangun menggunakan Tailwind CSS, JavaScript murni, dan memanfaatkan Firebase Firestore 
                     untuk analisis kunjungan dan unduhan real-time. Sekarang, secara otomatis terhubung ke database publik F-Droid.
                 </p>
                 <p class="text-sm text-[var(--text-muted)] pt-2">Versi Aplikasi: 1.0.6 (F-Droid Integration)</p>
                 <p class="text-xs text-[var(--text-muted)]">Pengembang: Alfitech Development Team</p>
            </div>
        </div>
    </div>
    
    
    <!-- MESSAGE BOX (Tidak diubah) -->
    <div id="message-box" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 max-w-sm w-full p-6 rounded-xl shadow-2xl z-[60] transition transform duration-300 border-2 text-center modal-content" style="border-color: var(--accent-blue);">
        <h3 id="message-box-title" class="text-xl font-bold mb-3" style="color: var(--accent-blue);">Judul</h3>
        <p id="message-box-message" class="mb-4 text-[var(--text-light)] text-opacity-80">Pesan.</p>
        <button onclick="document.getElementById('message-box').classList.add('hidden')" class="px-4 py-2 rounded-lg font-semibold" style="background-color: var(--accent-blue); color: var(--primary-bg);">OK</button>
    </div>


    <script>
        // Data statis/API akan disimpan di sini
        let fetchedContentData = [];
        let activeTab = 'apps'; // Default tab kini 'apps' (F-Droid)
        const contentList = document.getElementById('content-list');
        const searchInput = document.getElementById('search-input');
        const detailModal = document.getElementById('detail-modal');
        const settingsModal = document.getElementById('settings-modal');
        const scrollIndicator = document.getElementById('scroll-indicator'); 
        
        // --- KONSTANTA API F-DROID BARU ---
        const F_DROID_API_URL = 'https://f-droid.org/repo/index-v1.json'; 
        const F_DROID_REPO_BASE = 'https://f-droid.org/repo/';
        
        // --- FIREBASE GLOBALS (Hanya untuk Analytics) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        
        let app;
        let db;
        let auth;
        
        // Konstanta Koleksi Firestore (HANYA untuk ANALITIK)
        const ANALYTICS_COLLECTION = 'global_metrics';
        const ANALYTICS_DOC_ID = 'website_analytics'; 
        
        // --- LAZY LOADING / INTERSECTION OBSERVER ---
        // Observer untuk menambahkan kelas 'fade-in' saat elemen terlihat
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                    observer.unobserve(entry.target); // Hentikan observasi setelah terlihat
                }
            });
        }, { threshold: 0.1 });


        // --- UTILITIES ---

        function showMessageBox(title, message) {
            const box = document.getElementById('message-box');
            document.getElementById('message-box-title').textContent = title;
            document.getElementById('message-box-message').textContent = message;
            box.classList.remove('hidden');
        }
        
        // --- FIREBASE & ANALYTICS LOGIC (TIDAK BERUBAH) ---
        // ... (Fungsi-fungsi Firebase tetap sama: getGlobalAnalyticsDocRef, ensureAnalyticsDocumentExists, 
        // trackGlobalMetric, trackWebsiteVisit, trackAppDownload, trackDonateClick, setupAnalyticsListener, updateAnalyticsUI)
        
        function getGlobalAnalyticsDocRef() {
            if (!db) return null;
            return Firebase.doc(db, 'artifacts', appId, 'public', 'data', ANALYTICS_COLLECTION, ANALYTICS_DOC_ID);
        }

        async function ensureAnalyticsDocumentExists() {
            const docRef = getGlobalAnalyticsDocRef();
            if (!docRef) return;
            try {
                const docSnap = await Firebase.getDoc(docRef);
                if (!docSnap.exists()) {
                    await Firebase.setDoc(docRef, {
                        visits: 0,
                        downloads: 0,
                        donate_clicks: 0, 
                        last_updated: Firebase.serverTimestamp()
                    });
                }
            } catch (e) {
                console.error("Error ensuring analytics document exists:", e);
            }
        }

        async function trackGlobalMetric(metric) {
            const docRef = getGlobalAnalyticsDocRef();
            if (!docRef) return;
            try {
                await Firebase.updateDoc(docRef, {
                    [metric]: Firebase.increment(1)
                });
            } catch (e) {
                console.error(`Error tracking ${metric}:`, e);
            }
        }

        function trackWebsiteVisit() {
            trackGlobalMetric('visits');
        }

        function trackAppDownload(appName) {
            // Log download ke Firebase Analytics
            trackGlobalMetric('downloads');

            // Close modal after mock download
            closeDetails();
            // Show download success message
            showMessageBox(`Mulai mengunduh ${appName}!`, `Anda akan dialihkan ke tautan APK F-Droid. Statistik global bertambah.`);
        }
        
        function trackDonateClick() {
            trackGlobalMetric('donate_clicks');
        }

        function setupAnalyticsListener() {
            const docRef = getGlobalAnalyticsDocRef();
            if (!docRef) return;
            
            Firebase.onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    updateAnalyticsUI(docSnap.data());
                } else {
                    updateAnalyticsUI({ visits: 0, downloads: 0, donate_clicks: 0 });
                }
            }, (error) => {
                console.error("Error setting up analytics listener:", error);
            });
        }
        
        function updateAnalyticsUI(data) {
             document.getElementById('metric-visits').textContent = (data.visits || 0).toLocaleString('id-ID');
             document.getElementById('metric-downloads').textContent = (data.downloads || 0).toLocaleString('id-ID');
             document.getElementById('metric-donate-clicks').textContent = (data.donate_clicks || 0).toLocaleString('id-ID');
        }
        
        // --- LOGIC INTEGRASI API F-DROID BARU ---

        async function loadFDroidApps() {
            showSkeletonLoader();
            console.log(`[F-DROID] Mencoba mengambil data dari API: ${F_DROID_API_URL}`);
            
            try {
                await new Promise(resolve => setTimeout(resolve, 800)); 
                
                const response = await fetch(F_DROID_API_URL);
                
                if (!response.ok) {
                    throw new Error(`Gagal HTTP! Status: ${response.status}`);
                }
                
                const data = await response.json(); 
                // data.packages adalah Object, kita konversi ke Array untuk iterasi
                const packages = Object.values(data.packages); 

                fetchedContentData = packages.map(app => {
                    const latestVersion = app.versions[0];
                    // Mencari localized data, default ke 'en'
                    const localized = latestVersion.localized?.['in'] || latestVersion.localized?.['en'] || Object.values(latestVersion.localized)[0];
                    
                    const name = localized.name || app.metadata.packageName;
                    const summary = localized.summary || localized.description || 'Aplikasi Sumber Terbuka (Open Source).';
                    
                    return {
                        id: app.metadata.packageName, // Unique identifier
                        name: name,
                        category: app.metadata.categories?.[0] || 'Lainnya',
                        developer: app.metadata.authorName || 'Komunitas F-Droid',
                        rating: (Math.random() * (5 - 3.8) + 3.8).toFixed(1), // Mock rating
                        size: (latestVersion.size / (1024 * 1024)).toFixed(1) + ' MB',
                        installs: Math.floor(Math.random() * 5000 + 100).toLocaleString('id-ID') + '+', // Mock installs
                        version: latestVersion.versionName || 'N/A',
                        description: localized.description || summary,
                        features: localized.whatsNew?.split('\n').filter(f => f.trim()) || ['Selalu update otomatis', 'Open Source', 'Aman dan Gratis.'],
                        // Konstruksi URL Ikon dan Screenshot
                        icon_url: app.icon ? `${F_DROID_REPO_BASE}icons/${app.icon}` : null, 
                        screenshot_url: latestVersion.screenshots?.[0] ? `${F_DROID_REPO_BASE}${latestVersion.screenshots[0]}` : null,
                        downloadUrl: `${F_DROID_REPO_BASE}${latestVersion.apkName}` // Tautan APK
                    };
                });
                
                console.log(`[F-DROID] Sukses memuat ${fetchedContentData.length} aplikasi.`);
                
            } catch (error) {
                console.error("[F-DROID] Gagal memuat data dari F-Droid API:", error);
                
                contentList.innerHTML = `<div class="col-span-4 p-8 text-center text-red-400 rounded-xl mt-4 card-style">
                                            <p class="mb-2"><i class="fas fa-exclamation-triangle text-3xl"></i></p>
                                            <p class="text-lg font-semibold">Gagal memuat data dari F-Droid.</p>
                                            <p class="text-sm text-red-300 mt-1">Pastikan URL dan koneksi jaringan Anda tidak diblokir.</p>
                                            <p class="text-xs text-red-300 mt-2">Error: (${error.message || 'Kesalahan Jaringan'})</p>
                                        </div>`;
                
                fetchedContentData = []; 
            } finally {
                // Render content dipanggil di sini setelah data dimuat (atau gagal)
                renderContent();
            }
        }
        
        // --- LOADER / SKELETON LOGIC ---
        function showSkeletonLoader() {
             contentList.innerHTML = Array(8).fill(0).map(() => `
                 <div class="p-1 rounded-lg flex flex-col items-center text-center card-style skeleton-pulse">
                     <div class="w-9 h-9 rounded-lg mb-1 bg-gray-700"></div>
                     <div class="h-3 w-3/4 bg-gray-700 rounded mb-1"></div>
                     <div class="h-2 w-1/2 bg-gray-700 rounded"></div>
                 </div>
             `).join('');
        }
        
        // --- UI & TABS LOGIC ---
        
        function openSettingsModal(tab = 'analytics') {
            settingsModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            switchSettingsTab(tab);
            checkThemePreference();
        }

        function closeSettings() {
            settingsModal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        function switchSettingsTab(tabId) {
            document.querySelectorAll('#settings-modal .tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            document.getElementById(`content-${tabId}`).classList.remove('hidden');

            document.querySelectorAll('#settings-modal button[id^="tab-"]').forEach(btn => {
                btn.style.borderColor = 'transparent';
                btn.classList.add('text-[var(--text-muted)]');
                btn.classList.remove('text-[var(--text-light)]');
            });
            const activeBtn = document.getElementById(`tab-${tabId}`);
            if (activeBtn) {
                 activeBtn.style.borderColor = 'var(--accent-blue)';
                 activeBtn.classList.remove('text-[var(--text-muted)]');
                 activeBtn.classList.add('text-[var(--text-light)]');
            }
        }

        function switchTab(tab) {
            activeTab = tab;
            
            // Update Nav Bar visual state
            document.querySelectorAll('footer nav button').forEach(btn => {
                btn.classList.remove('text-[var(--accent-blue)]');
                btn.classList.add('text-[var(--text-muted)]');
            });
            document.getElementById(`${tab}-tab`).classList.remove('text-[var(--text-muted)]');
            document.getElementById(`${tab}-tab`).classList.add('text-[var(--accent-blue)]');

            // Handle Content Visibility
            document.querySelectorAll('.content-view').forEach(view => view.classList.add('hidden'));

            if (tab === 'apps') { // Konten F-Droid Apps
                document.getElementById('content-list').classList.remove('hidden');
                
                if (window.scrollY > 10) { 
                     scrollIndicator.classList.add('opacity-0', 'pointer-events-none'); 
                     scrollIndicator.classList.remove('flex'); 
                } else {
                     scrollIndicator.classList.remove('opacity-0', 'pointer-events-none'); 
                     scrollIndicator.classList.add('flex'); 
                }
                
                renderContent();
            } else if (tab === 'donate') {
                document.getElementById('content-donate-page').classList.remove('hidden');
                scrollIndicator.classList.add('opacity-0', 'pointer-events-none'); 
                scrollIndicator.classList.remove('flex'); 
            }
        }
        
        // --- CARD GENERATOR (Diperbarui untuk F-Droid) ---
        function createCard(item) {
            const card = document.createElement('div');
            // Menambahkan kelas card-initial-state untuk fade-in
            card.className = `p-1 rounded-lg transition transform hover:scale-[1.05] duration-300 cursor-pointer flex flex-col items-center text-center group card-style card-initial-state`;
            card.onclick = () => showDetails(item.id);
            
            // Ikon menggunakan <img> dari F-Droid (atau fallback)
            const iconHtml = item.icon_url ? 
                `<img src="${item.icon_url}" onerror="this.onerror=null;this.src='${F_DROID_REPO_BASE}icons/default.png';" alt="${item.name} Icon" class="w-9 h-9 rounded-lg mb-1 shadow-md group-hover:shadow-xl object-contain" style="background-color: transparent;"/>` :
                `<div class="w-9 h-9 rounded-lg flex items-center justify-center mb-1 text-white text-base shadow-md group-hover:shadow-xl transition duration-300" style="background-color: var(--accent-blue);">
                      <i class="fas fa-mobile-alt"></i>
                  </div>`;

            card.innerHTML = `
                ${iconHtml}
                <h3 class="text-[10px] font-bold truncate w-full px-1 text-[var(--text-light)]">${item.name || 'Nama Item'}</h3>
                <div class="flex items-center text-[8px] text-yellow-400 mt-[1px]">
                    <i class="fas fa-star text-[7px] mr-0.5"></i>
                    <span>${item.rating || 'N/A'}</span>
                </div>
            `;
            
            // Amati kartu untuk lazy-loading dan fade-in
            observer.observe(card);
            
            return card;
        }

        // --- SHOW DETAILS (Diperbarui untuk F-Droid) ---
        function showDetails(id) {
            const item = fetchedContentData.find(d => d.id === id);
            if (!item) return;

            document.getElementById('detail-name').textContent = item.name || 'Nama Aplikasi';
            document.getElementById('detail-category-dev').textContent = `${item.category || 'Kategori'} • ${item.developer || 'Pengembang'}`;
            document.getElementById('detail-rating').textContent = item.rating || 'N/A';
            document.getElementById('detail-size').textContent = item.size || '0 MB'; 
            document.getElementById('detail-installs').textContent = item.installs || '0';
            document.getElementById('detail-version').textContent = item.version || '1.0';
            document.getElementById('detail-description').textContent = item.description || 'Deskripsi tidak tersedia.';
            
            // Screenshot F-Droid
            const screenshotUrl = item.screenshot_url || 'https://placehold.co/600x338/E5E7EB/6B7280?text=NO+PREVIEW+AVAILABLE';
            document.getElementById('detail-screenshot').src = screenshotUrl; 
            document.getElementById('detail-screenshot').onerror = function() {
                this.src = 'https://placehold.co/600x338/E5E7EB/6B7280?text=NO+PREVIEW+AVAILABLE';
            };


            // Ikon Detail (menggunakan img)
            const detailIconDiv = document.getElementById('detail-icon');
            if (item.icon_url) {
                 detailIconDiv.innerHTML = `<img src="${item.icon_url}" onerror="this.onerror=null;this.src='${F_DROID_REPO_BASE}icons/default.png';" alt="${item.name} Icon" class="w-full h-full object-contain" style="background-color: transparent;"/>`;
                 detailIconDiv.style.backgroundColor = 'transparent'; 
                 detailIconDiv.style.padding = '4px'; // Tambahkan padding untuk ikon
            } else {
                detailIconDiv.innerHTML = `<i class="fas fa-mobile-alt"></i>`;
                detailIconDiv.style.backgroundColor = 'var(--accent-blue)';
                detailIconDiv.style.padding = '0';
            }
            
            const downloadLink = document.getElementById('detail-download-btn-link');
            downloadLink.href = item.downloadUrl || '#'; 
            downloadLink.onclick = (e) => {
                if (item.downloadUrl === '#') {
                    e.preventDefault();
                    showMessageBox("Tautan Tidak Tersedia", "Tautan download APK tidak ditemukan di F-Droid.");
                } else {
                    trackAppDownload(item.name); 
                }
            }; 

            const featuresList = document.getElementById('detail-features');
            const features = Array.isArray(item.features) ? item.features : [];

            featuresList.innerHTML = features.slice(0, 6).map(feature => // Batasi fitur hingga 6
                `<li class="flex items-center space-x-2">
                    <i class="fas fa-check-circle text-sm" style="color: var(--accent-blue);"></i>
                    <span class="text-[var(--text-light)] text-opacity-80">${feature}</span>
                </li>`
            ).join('');

            detailModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; 
            detailModal.scrollTop = 0;
        }

        function closeDetails() {
            detailModal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        function renderContent() {
            // Hanya render jika kita berada di tab 'apps'
            if (activeTab !== 'apps') return;
            
            const query = searchInput.value.toLowerCase();
            
            // Filter data F-Droid berdasarkan query
            const filteredData = fetchedContentData.filter(item =>
                (item.name && item.name.toLowerCase().includes(query) || 
                 item.category && item.category.toLowerCase().includes(query) ||
                 item.developer && item.developer.toLowerCase().includes(query))
            );

            contentList.innerHTML = '';
            
            if (filteredData.length === 0 && fetchedContentData.length > 0) {
                const message = `Tidak ada hasil ditemukan untuk "${query}".`;
                contentList.innerHTML = `<div class="col-span-2 sm:col-span-4 p-8 text-center text-[var(--text-muted)] rounded-xl mt-4 card-style">
                                            <p class="mb-2"><i class="fas fa-box-open"></i></p>
                                            <p>${message}</p>
                                        </div>`;
            } else if (filteredData.length > 0) {
                // Pastikan grid layout responsif
                contentList.className = 'content-view grid grid-cols-2 sm:grid-cols-4 gap-4 p-1';
                filteredData.forEach(item => {
                    contentList.appendChild(createCard(item));
                });
            }
            // Jika fetchedContentData.length === 0, pesan error sudah ditampilkan oleh loadFDroidApps
        }

        function handleSearch() {
            if (activeTab === 'apps') {
                 renderContent();
            }
        }

        // --- THREE.JS 3D Background Logic (TIDAK BERUBAH) ---
        let scene, camera, renderer, object;

        function initThreeJS() {
            const container = document.getElementById('bg-canvas');
            const parent = container.parentElement;

            scene = new THREE.Scene();
            
            const width = parent.clientWidth;
            const height = parent.clientHeight;
            
            camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
            camera.position.z = 5;
            
            renderer = new THREE.WebGLRenderer({ canvas: container, alpha: true });
            renderer.setSize(width, height);
            renderer.setPixelRatio(window.devicePixelRatio);
            
            const geometry = new THREE.DodecahedronGeometry(2, 0);
            
            const material = new THREE.MeshPhongMaterial({
                color: 0x00BCD4, 
                flatShading: true, 
                wireframe: true, 
                shininess: 50
            });
            
            object = new THREE.Mesh(geometry, material);
            scene.add(object);
            
            const ambientLight = new THREE.AmbientLight(0x404040, 5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(1, 1, 1).normalize();
            scene.add(directionalLight);
        }

        function updateThreeJSColor(theme) {
            if (object && object.material) {
                const color = theme === 'light' ? 0x007BFF : 0x00BCD4; 
                object.material.color.setHex(color);
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            if (object) {
                object.rotation.x += 0.005;
                object.rotation.y += 0.002;
            }
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            const container = document.getElementById('bg-canvas');
            const parent = container.parentElement;
            if (!parent) return;

            const width = parent.clientWidth;
            const height = parent.clientHeight;
            
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
        }
        window.addEventListener('resize', onWindowResize, false);
        
        function toggleTheme() {
            const isChecked = document.getElementById('theme-toggle').checked;
            const newTheme = isChecked ? 'light' : 'dark';
            localStorage.setItem('animation-theme', newTheme); 
            updateThreeJSColor(newTheme);
        }
        
        function checkThemePreference() {
            const savedTheme = localStorage.getItem('animation-theme') || 'dark'; 
            const toggle = document.getElementById('theme-toggle');
            if (toggle) {
                toggle.checked = (savedTheme === 'light');
            }
            updateThreeJSColor(savedTheme);
        }


        // --- Inisialisasi Aplikasi ---

        window.onload = function() {
            if (typeof Firebase !== 'undefined') {
                initializeFirebase();
            } else {
                console.error("Firebase library failed to load.");
                loadFDroidApps(); 
            }

            try {
                initThreeJS();
                animate();
            } catch (e) {
                console.error("Three.js gagal diinisialisasi.", e);
                document.getElementById('bg-canvas').style.display = 'none';
            }
            
            showSkeletonLoader();
            
            switchTab('apps'); // Default ke tab F-Droid Apps
            
             // Listener untuk menyembunyikan scroll indicator
            window.addEventListener('scroll', () => {
                if (activeTab === 'apps') {
                    if (window.scrollY > 10) { 
                        scrollIndicator.classList.add('opacity-0', 'pointer-events-none');
                        scrollIndicator.classList.remove('flex'); 
                    } else {
                        scrollIndicator.classList.remove('opacity-0', 'pointer-events-none');
                        scrollIndicator.classList.add('flex'); 
                    }
                }
            });
        };
        
        async function initializeFirebase() {
            if (!firebaseConfig || typeof Firebase === 'undefined') {
                await loadFDroidApps(); 
                return;
            }

            try {
                app = Firebase.initializeApp(firebaseConfig);
                db = Firebase.getFirestore(app);
                auth = Firebase.getAuth(app);
                
                Firebase.setLogLevel('Debug');

                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                if (initialAuthToken) {
                    await Firebase.signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await Firebase.signInAnonymously(auth);
                }
                
                await ensureAnalyticsDocumentExists();
                trackWebsiteVisit();
                setupAnalyticsListener();
                
                // --- PANGGILAN API F-DROID UNTUK KONTEN ---
                await loadFDroidApps(); 
                
                checkThemePreference();

            } catch (e) {
                console.error("Error initializing Firebase/F-Droid:", e);
                await loadFDroidApps(); 
            }
        }

    </script>
</body>
</html>

