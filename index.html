<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alfitech App Download</title>
    

<script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    

<script type="module">
        // Import modul Firebase yang diperlukan
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, serverTimestamp, increment, collection, setLogLevel, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Expose Firebase objects globally for use in the main script block
        window.Firebase = {
            initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, 
            getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, 
            serverTimestamp, increment, collection, setLogLevel, query
        };
    </script>

    <style>
        /* Variabel Warna Kustom (Dark Mode Permanen untuk UI) */
        :root {
            --primary-bg: #0A0F1D; 
            --secondary-bg: #151A2C; 
            --accent-blue: #00BCD4; 
            --text-light: #E0E7FF; 
            --text-muted: #9CA3AF; 
            --card-border: #1F2937;
            --shadow-color: rgba(0, 0, 0, 0.25);
            /* Perkiraan tinggi header tetap: Disesuaikan untuk menampung indikator di bawah search box */
            --header-height: 8rem; /* ~128px */
        }

        body {
            background-color: var(--primary-bg);
            color: var(--text-light);
            transition: background-color 0.3s, color 0.3s;
            /* PENTING: Mengatur padding-top agar konten yang bisa di-scroll dimulai DI BAWAH fixed header */
            padding-top: var(--header-height); 
            padding-bottom: 5rem;
            font-family: 'Inter', sans-serif;
        }

        /* Gaya Komponen */
        .card-style {
            background-color: var(--secondary-bg);
            border: 1px solid var(--card-border);
            color: var(--text-light);
            box-shadow: 0 4px 10px var(--shadow-color);
        }

        /* --- SKELETON LOADER ANIMATION --- */
        @keyframes pulse {
          0% { opacity: 0.8; }
          50% { opacity: 0.4; }
          100% { opacity: 0.8; }
        }
        .skeleton-pulse {
          animation: pulse 1.5s infinite ease-in-out;
        }
        /* --- END SKELETON LOADER --- */

        /* Logo Animasi */
        @keyframes logo-pulse {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.05) rotate(5deg); opacity: 0.85; }
        }
        .logo-a {
            animation: logo-pulse 3s infinite ease-in-out;
            will-change: transform, opacity;
        }
        .logo-a-color {
            color: var(--accent-blue); 
            border-color: var(--accent-blue); 
            box-shadow: 0 0 15px var(--accent-blue);
        }

        /* Header fixed di atas */
        .fixed-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 20;
            background-color: var(--primary-bg); 
            backdrop-filter: blur(5px);
            border-bottom: 1px solid var(--card-border);
            box-shadow: 0 4px 12px var(--shadow-color); 
            transition: background-color 0.3s, border-color 0.3s, box-shadow 0.3s;
            height: var(--header-height); /* Tinggi tetap */
        }
        
        /* Area Animasi yang Ikut Digulir */
        #landing-area {
            position: relative;
            width: 100%;
            /* Tinggi adalah sisa viewport dikurangi tinggi fixed header */
            height: calc(100vh - var(--header-height)); 
            overflow: hidden; /* Penting untuk mencegah scrollbar ganda */
        }
        
        /* Kanvas 3D mengisi landing-area */
        .bg-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -10; 
        }

        /* Modal Style */
        .modal-content {
            background-color: var(--secondary-bg);
            color: var(--text-light);
            box-shadow: 0 0 20px var(--shadow-color);
        }
        
        /* Input Field Style */
        .input-style {
            background-color: var(--primary-bg);
            border-color: var(--card-border);
            color: var(--text-light);
        }
        .input-style:focus {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px var(--accent-blue);
        }
        .input-style::placeholder {
            color: var(--text-muted) !important; 
        }
        
        /* Scroll Indicator */
        @keyframes bounce-cool {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-8px); }
            60% { transform: translateY(-4px); }
        }
        .animate-bounce-cool {
            animation: bounce-cool 2s infinite;
        }
        
        /* Donasi Link Pulse */
        @keyframes donasi-pulse {
            0% { box-shadow: 0 0 10px rgba(255, 152, 0, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 152, 0, 1), 0 0 40px rgba(255, 111, 0, 0.5); }
            100% { box-shadow: 0 0 10px rgba(255, 152, 0, 0.5); }
        }
        .donasi-link {
            animation: donasi-pulse 2s infinite ease-in-out;
        }

    </style>
</head>
<body>
    
    <!-- HEADER TETAP (FIXED) -->
<header class="fixed-header"> 
        <!-- Kontainer utama dengan semua elemen header -->
        <div class="max-w-4xl mx-auto px-4 pt-4 pb-3"> 
            

<div class="flex justify-between items-center mb-4">
                <div class="flex items-center text-3xl font-extrabold tracking-tight">
                    

<span class="logo-a mr-1 p-1 rounded-lg border-2 shadow-lg logo-a-color">A</span>
                    <span class="text-[var(--text-light)]">Alfitech App</span>
                </div>
                

<button id="settings-btn" onclick="openSettingsModal()" class="p-2 text-[var(--text-muted)] hover:text-[var(--accent-blue)] transition duration-150 rounded-full card-style">
                    <i class="fas fa-cog text-xl"></i>
                </button>
            </div>
            

<div class="mb-2"> 

<input type="text" id="search-input" placeholder="Cari Game atau Aplikasi..."
                       class="w-full p-3 rounded-xl border focus:ring-[var(--accent-blue)] focus:border-[var(--accent-blue)] shadow-lg transition duration-300 input-style"
                       oninput="handleSearch()">
            </div>
            
            <!-- INDIKATOR SCROLL DIPINDAH DI SINI (DI BAWAH SEARCH BOX) -->
            <div id="scroll-indicator" class="header-bottom-indicator flex flex-col items-center justify-center w-full py-2 text-[var(--accent-blue)] transition-opacity duration-500">
                <span class="text-xs font-semibold mb-1">Gulir Ke Bawah Untuk Melihat Aplikasi</span>
                <i class="fas fa-chevron-down text-xl animate-bounce-cool"></i>
            </div>
            <!-- AKHIR INDIKATOR SCROLL -->

        </div>
    </header>

    <!-- AREA LANDING YANG IKUT SCROLL BERSAMA KONTEN -->
    <div id="landing-area" class="w-full relative overflow-hidden mb-10">
        <!-- Canvas sekarang berada di flow dokumen dan akan tergulir -->
        <canvas id="bg-canvas" class="bg-canvas"></canvas>
    </div>
    <!-- AKHIR AREA LANDING -->

    

<div class="max-w-4xl mx-auto px-4">
        

<main id="content-list" class="content-view grid grid-cols-4 gap-2 p-1">
            

</main>
        
        

<div id="content-donate-page" class="content-view hidden p-8 text-center mt-10 rounded-xl card-style">
            <i class="fas fa-hand-holding-heart text-5xl mb-4" style="color: var(--accent-blue);"></i>
            <h2 class="text-2xl font-bold mb-4 text-[var(--text-light)]">Ayo Dukung Kami Alfitech App!</h2>
            <p class="text-lg text-[var(--text-light)] text-opacity-80 mb-8">
                Dukungan Anda sangat berarti bagi kami untuk menjaga server tetap berjalan,
                mengembangkan fitur-fitur baru, dan terus memberikan aplikasi terbaik.
            </p>
            
            <p class="text-xl font-bold mb-6 text-[var(--text-light)]">
                Silakan klik disini:
            </p>
            
            <a href="https://trakteer.id/Alfitech_app" target="_blank" onclick="trackDonateClick()"
               class="inline-block px-8 py-4 rounded-full text-xl font-extrabold shadow-2xl transition duration-300 transform hover:scale-105 donasi-link"
               style="background: linear-gradient(45deg, #FF6F00, #FF9800); color: #FFF;">
                <i class="fas fa-money-check-alt mr-2"></i> DONASI SEKARANG
            </a>
            
        </div>
    </div>

    

<footer class="fixed bottom-0 left-0 right-0 backdrop-blur-sm border-t z-10" style="background-color: var(--primary-bg); border-color: var(--card-border); box-shadow: 0 -4px 12px var(--shadow-color);">
        <nav class="flex justify-around items-center h-16 max-w-lg mx-auto">
            

<button id="games-tab" onclick="switchTab('games')" class="flex flex-col items-center justify-center p-2 flex-1 text-[var(--accent-blue)] transition duration-200">
                <i class="fas fa-gamepad text-xl"></i>
                <span class="text-xs mt-1 font-semibold">Game</span>
            </button>
            

<button id="apps-tab" onclick="switchTab('apps')" class="flex flex-col items-center justify-center p-2 flex-1 text-[var(--text-muted)] hover:text-[var(--accent-blue)] transition duration-200">
                <i class="fas fa-mobile-alt text-xl"></i>
                <span class="text-xs mt-1 font-semibold">Aplikasi</span>
            </button>
            

<button id="donate-tab" onclick="switchTab('donate')" class="flex flex-col items-center justify-center p-2 flex-1 text-[var(--text-muted)] hover:text-[var(--accent-blue)] transition duration-200">
                <i class="fas fa-heart text-xl"></i>
                <span class="text-xs mt-1 font-semibold">Donasi</span>
            </button>
        </nav>
    </footer>

    

<div id="detail-modal" class="hidden fixed inset-0 z-50 overflow-y-auto backdrop-blur-sm bg-gray-900/90 transition-opacity duration-300">
        <div class="modal-content max-w-xl mx-auto my-0 pt-0 pb-20 rounded-xl sm:rounded-b-none min-h-full">
            <button onclick="closeDetails()" class="fixed top-2 left-2 sm:absolute sm:top-4 sm:left-4 p-2 rounded-full transition text-white z-50" style="background-color: rgba(0, 0, 0, 0.5); hover:background-color: rgba(0, 0, 0, 0.7);">
                <i class="fas fa-arrow-left text-lg"></i>
            </button>
            
            <div class="w-full aspect-video rounded-b-lg overflow-hidden mb-4 relative">
                <img id="detail-screenshot" src="" onerror="this.onerror=null;this.src='https://placehold.co/600x338/E5E7EB/6B7280?text=PREVIEW+MEDIA';" alt="Screenshot Aplikasi" class="w-full h-full object-cover">
            </div>

            <div class="px-4 sm:px-6">
                <div class="flex items-start mb-6">
                    <div id="detail-icon" class="w-16 h-16 rounded-xl flex items-center justify-center text-3xl text-white shadow-xl flex-shrink-0" style="background-color: var(--accent-blue);">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <div class="ml-4 flex-grow">
                        <h2 id="detail-name" class="text-xl font-bold truncate text-[var(--text-light)]">Nama Aplikasi</h2>
                        <p id="detail-category-dev" class="text-xs text-[var(--text-muted)] mt-1">Kategori • Pengembang</p>
                    </div>
                    
                    <button id="detail-download-btn" class="py-2 px-4 rounded-full text-sm font-bold transition duration-200 hover:brightness-110 flex-shrink-0 ml-4" style="background-color: var(--accent-blue); color: var(--secondary-bg);">
                        <i class="fas fa-download mr-1"></i> Unduh
                    </button>
                </div>

                

<div class="flex justify-between items-center text-center py-3 border-y mb-6" style="border-color: var(--card-border);">
                    <div class="flex-1"><div class="text-base font-bold flex items-center justify-center text-[var(--text-light)]"><i class="fas fa-star text-yellow-400 text-sm mr-1"></i><span id="detail-rating">4.5</span></div><p class="text-[10px] text-[var(--text-muted)]">Ulasan</p></div>
                    <div class="w-[1px] h-6" style="background-color: var(--card-border);"></div>
                    <div class="flex-1"><div id="detail-size" class="text-base font-bold text-[var(--text-light)]">0 MB</div><p class="text-[10px] text-[var(--text-muted)]">Ukuran</p></div>
                    <div class="w-[1px] h-6" style="background-color: var(--card-border);"></div>
                    <div class="flex-1"><div id="detail-installs" class="text-base font-bold text-[var(--text-light)]">1M+</div><p class="text-[10px] text-[var(--text-muted)]">Pemasangan</p></div>
                    <div class="w-[1px] h-6" style="background-color: var(--card-border);"></div>
                    <div class="flex-1"><div id="detail-version" class="text-base font-bold text-[var(--text-light)]">1.0</div><p class="text-[10px] text-[var(--text-muted)]">Versi</p></div>
                </div>

                <h3 class="text-lg font-bold mb-3" style="color: var(--accent-blue);">Tentang Aplikasi Ini</h3>
                <p id="detail-description" class="text-[var(--text-light)] text-opacity-80 leading-relaxed text-sm mb-6"></p>

                <h3 class="text-lg font-bold mb-3" style="color: var(--accent-blue);">Fitur Utama</h3>
                <ul id="detail-features" class="grid grid-cols-1 sm:grid-cols-2 gap-4 list-none p-0 text-sm mb-10">
                    

</ul>
            </div>
        </div>
    </div>
    
    

<div id="settings-modal" class="hidden fixed inset-0 z-50 overflow-y-auto backdrop-blur-sm bg-gray-900/90 transition-opacity duration-300">
        <div class="max-w-xl mx-auto my-4 p-4 sm:p-6 rounded-xl shadow-2xl modal-content">
            <div class="flex justify-between items-start mb-4 border-b pb-4" style="border-color: var(--card-border);">
                <h2 class="text-2xl font-bold text-[var(--text-light)]">Pengaturan & Analisis</h2>
                <button onclick="closeSettings()" class="p-2 rounded-full hover:bg-[var(--primary-bg)] transition text-[var(--text-muted)] hover:text-[var(--accent-blue)]">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            

<div id="settings-tabs" class="flex border-b mb-6" style="border-color: var(--card-border);">
                <button id="tab-analytics" onclick="switchSettingsTab('analytics')" class="p-3 text-sm font-semibold border-b-2 border-transparent transition duration-200">Analisis Website</button>
                <button id="tab-theme" onclick="switchSettingsTab('theme')" class="p-3 text-sm font-semibold border-b-2 border-transparent transition duration-200 text-[var(--text-muted)]">Tampilan</button>
                <button id="tab-about" onclick="switchSettingsTab('about')" class="p-3 text-sm font-semibold border-b-2 border-transparent transition duration-200 text-[var(--text-muted)]">Tentang App</button>
            </div>

            

<div id="content-analytics" class="tab-content space-y-6">
                <h3 class="text-lg font-bold border-b pb-2" style="border-color: var(--card-border); color: var(--accent-blue);">Statistik Global Website</h3>
                
                <div class="grid grid-cols-3 gap-3 text-center">
                    <div class="p-3 rounded-xl shadow-inner border" style="background-color: var(--primary-bg); border-color: var(--card-border);">
                        <p id="metric-visits" class="text-2xl font-extrabold text-[var(--accent-blue)]">0</p>
                        <p class="text-xs text-[var(--text-muted)]">Kunjungan</p>
                    </div>
                    <div class="p-3 rounded-xl shadow-inner border" style="background-color: var(--primary-bg); border-color: var(--card-border);">
                        <p id="metric-downloads" class="text-2xl font-extrabold text-green-500">0</p>
                        <p class="text-xs text-[var(--text-muted)]">Total Unduhan</p>
                    </div>
                    <div class="p-3 rounded-xl shadow-inner border" style="background-color: var(--primary-bg); border-color: var(--card-border);">
                        <p id="metric-donate-clicks" class="text-2xl font-extrabold text-yellow-500">0</p>
                        <p class="text-xs text-[var(--text-muted)]">Klik Donasi</p>
                    </div>
                </div>
                
                <p class="text-xs text-[var(--text-muted)] pt-2 text-center">Data diperbarui secara real-time dari Firestore.</p>
            </div>
            
            

<div id="content-theme" class="tab-content hidden space-y-6">
                 <h3 class="text-lg font-bold border-b pb-2" style="border-color: var(--card-border); color: var(--accent-blue);">Pilihan Tampilan Animasi 3D</h3>
                 
                 <div class="flex justify-between items-center p-4 rounded-xl card-style border-none">
                     <span class="text-base font-semibold text-[var(--text-light)]">Gunakan Warna Terang pada Animasi</span>
                     <label class="relative inline-flex items-center cursor-pointer">
                         <input type="checkbox" id="theme-toggle" class="sr-only peer" onchange="toggleTheme()">
                         <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-[var(--accent-blue)]"></div>
                     </label>
                 </div>
                 
                 <p class="text-sm text-[var(--text-muted)] pt-2">Hanya warna objek 3D di latar belakang yang akan berubah. Seluruh tema website akan tetap dalam Mode Gelap.</p>
            </div>
            
            

<div id="content-about" class="tab-content hidden space-y-4">
                 <h3 class="text-lg font-bold border-b pb-2" style="border-color: var(--card-border); color: var(--accent-blue);">Tentang Alfitech App</h3>
                 <p class="text-sm text-[var(--text-light)]">
                     Alfitech App adalah platform unduhan aplikasi dan game simulasi yang dirancang untuk demonstrasi. 
                     Kami menampilkan berbagai konten fiktif dengan antarmuka yang modern, responsif, dan kaya fitur. 
                     Aplikasi ini dibangun menggunakan Tailwind CSS, JavaScript murni, dan memanfaatkan Firebase Firestore 
                     untuk analisis kunjungan dan unduhan real-time.
                 </p>
                 <p class="text-sm text-[var(--text-muted)] pt-2">Versi Aplikasi: 1.0.5 (Minor Refactor)</p>
                 <p class="text-xs text-[var(--text-muted)]">Pengembang: Alfitech Development Team</p>
            </div>
        </div>
    </div>
    
    

<div id="message-box" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 max-w-sm w-full p-6 rounded-xl shadow-2xl z-[60] transition transform duration-300 border-2 text-center modal-content" style="border-color: var(--accent-blue);">
        <h3 id="message-box-title" class="text-xl font-bold mb-3" style="color: var(--accent-blue);">Judul</h3>
        <p id="message-box-message" class="mb-4 text-[var(--text-light)] text-opacity-80">Pesan.</p>
        <button onclick="document.getElementById('message-box').classList.add('hidden')" class="px-4 py-2 rounded-lg font-semibold" style="background-color: var(--accent-blue); color: var(--primary-bg);">OK</button>
    </div>


    <script>
        // Data statis telah dihapus dan akan diganti dengan data dari Firestore
        let fetchedContentData = [];
        let activeTab = 'games';
        const contentList = document.getElementById('content-list');
        const searchInput = document.getElementById('search-input');
        const detailModal = document.getElementById('detail-modal');
        const settingsModal = document.getElementById('settings-modal');
        const scrollIndicator = document.getElementById('scroll-indicator'); 
        
        // --- FIREBASE GLOBALS ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        
        let app;
        let db;
        let auth;
        
        // Konstanta Koleksi Firestore
        const ANALYTICS_COLLECTION = 'global_metrics';
        const ANALYTICS_DOC_ID = 'website_analytics'; 
        const CONTENT_COLLECTION = 'content'; // Koleksi untuk menyimpan Aplikasi dan Game Anda

        // --- UTILITIES ---

        function showMessageBox(title, message) {
            const box = document.getElementById('message-box');
            document.getElementById('message-box-title').textContent = title;
            document.getElementById('message-box-message').textContent = message;
            box.classList.remove('hidden');
        }
        
        // --- FIREBASE & ANALYTICS LOGIC ---
        
        function getGlobalAnalyticsDocRef() {
            // Path: /artifacts/{appId}/public/data/global_metrics/website_analytics
            if (!db) return null;
            return Firebase.doc(db, 'artifacts', appId, 'public', 'data', ANALYTICS_COLLECTION, ANALYTICS_DOC_ID);
        }

        function getContentCollectionRef() {
            // Path: /artifacts/{appId}/public/data/content (Implementasi "F-Drop")
            if (!db) return null;
            return Firebase.collection(db, 'artifacts', appId, 'public', 'data', CONTENT_COLLECTION);
        }

        async function ensureAnalyticsDocumentExists() {
            const docRef = getGlobalAnalyticsDocRef();
            if (!docRef) return;
            try {
                const docSnap = await Firebase.getDoc(docRef);
                if (!docSnap.exists()) {
                    console.log("Creating new global analytics document...");
                    await Firebase.setDoc(docRef, {
                        visits: 0,
                        downloads: 0,
                        donate_clicks: 0, 
                        last_updated: Firebase.serverTimestamp()
                    });
                }
            } catch (e) {
                console.error("Error ensuring analytics document exists:", e);
            }
        }

        async function trackGlobalMetric(metric) {
            const docRef = getGlobalAnalyticsDocRef();
            if (!docRef) return;
            try {
                await Firebase.updateDoc(docRef, {
                    [metric]: Firebase.increment(1)
                });
            } catch (e) {
                console.error(`Error tracking ${metric}:`, e);
            }
        }

        function trackWebsiteVisit() {
            trackGlobalMetric('visits');
        }

        function trackAppDownload(appName) {
            trackGlobalMetric('downloads');

            // Close modal after mock download
            closeDetails();
            // Show download success message
            showMessageBox(`Sukses mengunduh ${appName}!`, `Simulasi unduhan berhasil. Statistik global bertambah.`);
        }
        
        function trackDonateClick() {
            trackGlobalMetric('donate_clicks');
        }

        function setupAnalyticsListener() {
            const docRef = getGlobalAnalyticsDocRef();
            if (!docRef) return;
            
            Firebase.onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    updateAnalyticsUI(docSnap.data());
                } else {
                    updateAnalyticsUI({ visits: 0, downloads: 0, donate_clicks: 0 });
                }
            }, (error) => {
                console.error("Error setting up analytics listener:", error);
            });
        }
        
        function setupContentListener() {
            const contentRef = getContentCollectionRef();
            if (!contentRef) return;

            showSkeletonLoader(); // Tampilkan loader sebelum ambil data
            
            // Menggunakan onSnapshot untuk mendapatkan data real-time
            Firebase.onSnapshot(Firebase.query(contentRef), (snapshot) => {
                fetchedContentData = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data(),
                    // Pastikan features adalah array
                    features: Array.isArray(doc.data().features) ? doc.data().features : []
                }));
                console.log(`Fetched ${fetchedContentData.length} items from Firestore (F-Drop).`);
                
                // Setelah data diambil, render konten berdasarkan tab aktif
                renderContent(); 
                hideSkeletonLoader();
                
            }, (error) => {
                console.error("Error listening to content data:", error);
                hideSkeletonLoader();
                contentList.innerHTML = `<div class="col-span-4 p-8 text-center text-red-400 rounded-xl mt-4 card-style">
                                            <p class="mb-2"><i class="fas fa-exclamation-triangle"></i></p>
                                            <p>Gagal memuat konten dari F-Drop (Firestore). Periksa koneksi atau aturan keamanan.</p>
                                        </div>`;
            });
        }

        async function initializeFirebase() {
            if (!firebaseConfig || typeof Firebase === 'undefined') {
                console.error("Firebase library or configuration is missing.");
                return;
            }

            try {
                app = Firebase.initializeApp(firebaseConfig);
                db = Firebase.getFirestore(app);
                auth = Firebase.getAuth(app);
                
                Firebase.setLogLevel('Debug');

                // Autentikasi
                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                if (initialAuthToken) {
                    await Firebase.signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await Firebase.signInAnonymously(auth);
                }
                
                // Inisialisasi Listeners
                await ensureAnalyticsDocumentExists();
                trackWebsiteVisit();
                setupAnalyticsListener();
                setupContentListener(); // Inisialisasi data konten (F-Drop)
                
                // Cek preferensi tema animasi
                checkThemePreference();

            } catch (e) {
                console.error("Error initializing Firebase:", e);
            }
        }
        
        function updateAnalyticsUI(data) {
            const formatter = new Intl.NumberFormat('id-ID', { minimumFractionDigits: 0 });
            
            document.getElementById('metric-visits').textContent = formatter.format(data.visits || 0);
            document.getElementById('metric-downloads').textContent = formatter.format(data.downloads || 0);
            document.getElementById('metric-donate-clicks').textContent = formatter.format(data.donate_clicks || 0);
        }

        // --- TEMA LOGIC (Hanya untuk Animasi) ---

        function toggleTheme() {
            const isChecked = document.getElementById('theme-toggle').checked;
            const newTheme = isChecked ? 'light' : 'dark';
            
            localStorage.setItem('animation-theme', newTheme); 
            
            updateThreeJSColor(newTheme);
        }
        
        function checkThemePreference() {
            const savedTheme = localStorage.getItem('animation-theme') || 'dark'; 
            
            const toggle = document.getElementById('theme-toggle');
            if (toggle) {
                toggle.checked = (savedTheme === 'light');
            }
            
            updateThreeJSColor(savedTheme);
        }
        
        // --- LOADER / SKELETON LOGIC ---
        function showSkeletonLoader() {
             contentList.innerHTML = Array(8).fill(0).map(() => `
                 <div class="p-1 rounded-lg flex flex-col items-center text-center card-style skeleton-pulse">
                     <div class="w-9 h-9 rounded-lg mb-1 bg-gray-700"></div>
                     <div class="h-3 w-3/4 bg-gray-700 rounded mb-1"></div>
                     <div class="h-2 w-1/2 bg-gray-700 rounded"></div>
                 </div>
             `).join('');
        }
        
        function hideSkeletonLoader() {
            // Skeleton loader disembunyikan secara implisit ketika renderContent dipanggil
        }
        // --- END LOADER / SKELETON LOGIC ---


        // --- UI & TABS LOGIC ---
        
        function openSettingsModal(tab = 'analytics') {
            settingsModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            switchSettingsTab(tab);
            checkThemePreference();
        }

        function closeSettings() {
            settingsModal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        function switchSettingsTab(tabId) {
            document.querySelectorAll('#settings-modal .tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            document.getElementById(`content-${tabId}`).classList.remove('hidden');

            document.querySelectorAll('#settings-modal button[id^="tab-"]').forEach(btn => {
                btn.style.borderColor = 'transparent';
                btn.classList.add('text-[var(--text-muted)]');
                btn.classList.remove('text-[var(--text-light)]');
            });
            const activeBtn = document.getElementById(`tab-${tabId}`);
            if (activeBtn) {
                 activeBtn.style.borderColor = 'var(--accent-blue)';
                 activeBtn.classList.remove('text-[var(--text-muted)]');
                 activeBtn.classList.add('text-[var(--text-light)]');
            }
        }

        function switchTab(tab) {
            activeTab = tab;
            
            // Update Nav Bar visual state
            document.querySelectorAll('footer nav button').forEach(btn => {
                btn.classList.remove('text-[var(--accent-blue)]');
                btn.classList.add('text-[var(--text-muted)]');
            });
            document.getElementById(`${tab}-tab`).classList.remove('text-[var(--text-muted)]');
            document.getElementById(`${tab}-tab`).classList.add('text-[var(--accent-blue)]');

            // Handle Content Visibility
            document.querySelectorAll('.content-view').forEach(view => view.classList.add('hidden'));

            if (tab === 'games' || tab === 'apps') {
                document.getElementById('content-list').classList.remove('hidden');
                
                // Logic untuk Indikator Scroll
                // Indikator disembunyikan jika sudah menggulir lebih dari 10px
                if (window.scrollY > 10) { 
                     scrollIndicator.classList.add('opacity-0', 'pointer-events-none'); 
                     scrollIndicator.classList.remove('flex'); // Sembunyikan dengan display: none
                } else {
                     scrollIndicator.classList.remove('opacity-0', 'pointer-events-none'); 
                     scrollIndicator.classList.add('flex'); // Tampilkan dengan display: flex
                }
                
                // Hanya tampilkan loader jika data belum ada, jika sudah ada langsung render
                if (fetchedContentData.length === 0) {
                    showSkeletonLoader();
                } else {
                    renderContent();
                }
            } else if (tab === 'donate') {
                document.getElementById('content-donate-page').classList.remove('hidden');
                scrollIndicator.classList.add('opacity-0', 'pointer-events-none'); 
                scrollIndicator.classList.remove('flex'); // Sembunyikan saat di tab donate
            }
        }

        function createCard(item) {
            const card = document.createElement('div');
            card.className = `p-1 rounded-lg transition transform hover:scale-[1.05] duration-300 cursor-pointer flex flex-col items-center text-center group card-style`;
            card.onclick = () => showDetails(item.id);
            
            // Jika item.icon tidak ada, gunakan placeholder
            const iconClass = item.icon || 'fas fa-question'; 

            const iconHtml = `<div class="w-9 h-9 rounded-lg flex items-center justify-center mb-1 text-white text-base shadow-md group-hover:shadow-xl transition duration-300" style="background-color: var(--accent-blue);">
                                  <i class="${iconClass}"></i>
                              </div>`;

            card.innerHTML = `
                ${iconHtml}
                <h3 class="text-[10px] font-bold truncate w-full px-1 text-[var(--text-light)]">${item.name || 'Nama Item'}</h3>
                <div class="flex items-center text-[8px] text-yellow-400 mt-[1px]">
                    <i class="fas fa-star text-[7px] mr-0.5"></i>
                    <span>${item.rating || 'N/A'}</span>
                </div>
            `;
            return card;
        }

        function showDetails(id) {
            // Cari data di fetchedContentData
            const item = fetchedContentData.find(d => d.id === id);
            if (!item) return;

            document.getElementById('detail-name').textContent = item.name || 'Nama Aplikasi';
            document.getElementById('detail-category-dev').textContent = `${item.category || 'Kategori'} • ${item.developer || 'Pengembang'}`;
            document.getElementById('detail-rating').textContent = item.rating || 'N/A';
            document.getElementById('detail-size').textContent = item.size || '0 MB';
            document.getElementById('detail-installs').textContent = item.installs || '0';
            document.getElementById('detail-version').textContent = item.version || '1.0';
            document.getElementById('detail-description').textContent = item.description || 'Deskripsi tidak tersedia.';
            
            const screenshotUrl = item.screenshot_url || 'https://placehold.co/600x338/E5E7EB/6B7280?text=PREVIEW+MEDIA';
            document.getElementById('detail-screenshot').src = screenshotUrl; 

            document.getElementById('detail-icon').innerHTML = `<i class="${item.icon || 'fas fa-mobile-alt'}"></i>`;
            
            const downloadBtn = document.getElementById('detail-download-btn');
            downloadBtn.onclick = null; 
            downloadBtn.onclick = () => trackAppDownload(item.name); 

            const featuresList = document.getElementById('detail-features');
            // Pastikan features adalah array sebelum mapping
            const features = Array.isArray(item.features) ? item.features : [];

            featuresList.innerHTML = features.map(feature => 
                `<li class="flex items-center space-x-2">
                    <i class="fas fa-check-circle text-sm" style="color: var(--accent-blue);"></i>
                    <span class="text-[var(--text-light)] text-opacity-80">${feature}</span>
                </li>`
            ).join('');

            detailModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; 
            detailModal.scrollTop = 0;
        }

        function closeDetails() {
            detailModal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        function renderContent() {
            const query = searchInput.value.toLowerCase();
            
            // Filter data dari Firestore berdasarkan tab aktif ('games' atau 'apps') dan query pencarian
            const filteredData = fetchedContentData.filter(item =>
                item.type === activeTab &&
                (item.name && item.name.toLowerCase().includes(query) || 
                 item.category && item.category.toLowerCase().includes(query))
            );

            contentList.innerHTML = '';
            
            if (filteredData.length === 0) {
                const message = fetchedContentData.length === 0 && query === '' 
                    ? `Tidak ada konten yang ditemukan di F-Drop (Firestore). Silakan tambahkan item ke koleksi 'content'.`
                    : `Tidak ada hasil ditemukan untuk "${query}" di kategori ${activeTab === 'games' ? 'Game' : 'Aplikasi'}.`;

                contentList.innerHTML = `<div class="col-span-4 p-8 text-center text-[var(--text-muted)] rounded-xl mt-4 card-style">
                                            <p class="mb-2"><i class="fas fa-box-open"></i></p>
                                            <p>${message}</p>
                                        </div>`;
            } else {
                filteredData.forEach(item => {
                    contentList.appendChild(createCard(item));
                });
            }
        }

        function handleSearch() {
            if (activeTab === 'games' || activeTab === 'apps') {
                 // Hanya render ulang data yang sudah di-cache
                 renderContent();
            }
        }

        // --- THREE.JS 3D Background Logic ---
        let scene, camera, renderer, object;

        function initThreeJS() {
            const container = document.getElementById('bg-canvas');
            const parent = container.parentElement;

            scene = new THREE.Scene();
            
            // Gunakan ukuran parent untuk aspect ratio awal
            const width = parent.clientWidth;
            const height = parent.clientHeight;
            
            camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
            camera.position.z = 5;
            
            renderer = new THREE.WebGLRenderer({ canvas: container, alpha: true });
            renderer.setSize(width, height);
            renderer.setPixelRatio(window.devicePixelRatio);
            
            const geometry = new THREE.DodecahedronGeometry(2, 0);
            
            // Material akan mendapatkan warna dari updateThreeJSColor saat inisialisasi
            const material = new THREE.MeshPhongMaterial({
                color: 0x00BCD4, // Default dark theme color (Cyan)
                flatShading: true, 
                wireframe: true, 
                shininess: 50
            });
            
            object = new THREE.Mesh(geometry, material);
            scene.add(object);
            
            const ambientLight = new THREE.AmbientLight(0x404040, 5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(1, 1, 1).normalize();
            scene.add(directionalLight);
        }

        function updateThreeJSColor(theme) {
            if (object && object.material) {
                // Light mode: Biru terang (0x007BFF) vs Dark mode: Cyan (0x00BCD4)
                const color = theme === 'light' ? 0x007BFF : 0x00BCD4; 
                object.material.color.setHex(color);
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            if (object) {
                object.rotation.x += 0.005;
                object.rotation.y += 0.002;
            }
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            const container = document.getElementById('bg-canvas');
            const parent = container.parentElement;
            if (!parent) return;

            const width = parent.clientWidth;
            const height = parent.clientHeight;
            
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
        }
        window.addEventListener('resize', onWindowResize, false);


        // --- Inisialisasi Aplikasi ---

        window.onload = function() {
            if (typeof Firebase !== 'undefined') {
                initializeFirebase();
            } else {
                console.error("Firebase library failed to load.");
            }

            try {
                initThreeJS();
                animate();
            } catch (e) {
                console.error("Three.js gagal diinisialisasi.", e);
                document.getElementById('bg-canvas').style.display = 'none';
            }
            
            // Tampilkan loader awal saat inisialisasi, sebelum data datang
            showSkeletonLoader();
            
            // Render konten awal (Games)
            switchTab('games');
            
             // Listener untuk menyembunyikan scroll indicator
            window.addEventListener('scroll', () => {
                if (activeTab === 'games' || activeTab === 'apps') {
                    // Menyembunyikan indikator setelah menggulir lebih dari 10px (hampir langsung)
                    if (window.scrollY > 10) { 
                        scrollIndicator.classList.add('opacity-0', 'pointer-events-none');
                        scrollIndicator.classList.remove('flex'); // Sembunyikan dengan display: none
                    } else {
                        scrollIndicator.classList.remove('opacity-0', 'pointer-events-none');
                        scrollIndicator.classList.add('flex'); // Tampilkan dengan display: flex
                    }
                }
            });
        };

    </script>
</body>
</html>

