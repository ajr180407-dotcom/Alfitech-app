<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alfitech App - Download Resmi</title>
    <!-- Memuat Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FIREBASE SDK IMPORTS (MANDATORY) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setPersistence, browserSessionPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query, getDocs, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Variabel Global untuk Firebase dan User
        window.db = null;
        window.auth = null;
        window.userId = null;
        window.isAuthReady = false;
        window.currentUser = null; // Menyimpan objek user dari Firebase
        
        window.allAppsAndGames = []; 

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        const APPS_COLLECTION = `/artifacts/${appId}/public/data/apps`;

        // -----------------------------------------------------
        // 1. INJEKSI MOCK DATA (Simulasi Data "f drop")
        // -----------------------------------------------------
        const initialMockData = [
            // Aplikasi
            { id: 'app1', name: 'FaceApp: Editor Wajah', publisher: 'FaceApp Tech..', rating: 4.5, size: '47 MB', color: 'bg-indigo-600', type: 'aplikasi', isRecommended: true, icon: 'üôÇ' },
            { id: 'app2', name: 'Agnes AI', publisher: 'Agnes Corp', rating: 4.7, size: '57 MB', color: 'bg-purple-500', type: 'aplikasi', isRecommended: true, icon: 'üíÖ' },
            { id: 'app3', name: 'Shopee Indonesia', publisher: 'Marketplace online', rating: 4.7, size: '88 MB', color: 'bg-red-500', type: 'aplikasi', isRecommended: true, icon: 'üõçÔ∏è' },
            { id: 'app4', name: 'UpFoto - AI Photo Enhan...', publisher: 'AI Photo Team', rating: 4.8, size: '32 MB', color: 'bg-pink-500', type: 'aplikasi', isRecommended: false, icon: 'üì∏' },
            { id: 'app5', name: 'Strategi Marketing', publisher: 'Alfitech', rating: 4.5, size: '55 MB', color: 'bg-yellow-600', type: 'aplikasi', isRecommended: true, icon: 'S' },
            { id: 'app6', name: 'Keuangan Pribadi', publisher: 'Finance Corp', rating: 4.7, size: '30 MB', color: 'bg-red-500', type: 'aplikasi', isRecommended: false, icon: 'üí∞' },
            
            // Game
            { id: 'game1', name: 'Honor of Kings', publisher: 'MOBA ‚Ä¢ Kasual', rating: 4.1, size: '347 MB', color: 'bg-red-700', type: 'game', isRecommended: true, icon: '‚öîÔ∏è' },
            { id: 'game2', name: 'Football Dream: Be A Pro', publisher: 'Sepak Bola ‚Ä¢ Multiplayer', rating: 3.6, size: '593 MB', color: 'bg-blue-600', type: 'game', isRecommended: true, icon: '‚öΩ' },
            { id: 'game3', name: 'Crossfire: Legends', publisher: 'Level Infinite', rating: 4.6, size: '1.2 GB', color: 'bg-green-700', type: 'game', isRecommended: false, icon: 'üî´' },
            { id: 'game4', name: 'Clash of Clans', publisher: 'Supercell', rating: 4.3, size: '150 MB', color: 'bg-yellow-700', type: 'game', isRecommended: false, icon: 'üè∞' },
        ];

        async function seedInitialData(database) {
            const collectionRef = collection(database, APPS_COLLECTION);
            const snapshot = await getDocs(collectionRef);
            
            if (snapshot.empty) {
                console.log("Firestore: Seeding initial data...");
                for (const item of initialMockData) {
                    await setDoc(doc(database, APPS_COLLECTION, item.id), item);
                }
                console.log("Firestore: Data seeding complete.");
            } else {
                 console.log("Firestore: Collection already populated. Skipping seed.");
            }
        }

        // -----------------------------------------------------
        // 2. INIOLISASI FIREBASE DAN AUTENTIKASI
        // -----------------------------------------------------
        async function initializeAppAndAuth() {
            try {
                setLogLevel('debug');
                
                const app = initializeApp(firebaseConfig);
                window.db = getFirestore(app);
                window.auth = getAuth(app);

                await setPersistence(window.auth, browserSessionPersistence);
                
                // Autentikasi
                if (initialAuthToken) {
                    await signInWithCustomToken(window.auth, initialAuthToken);
                } else {
                    await signInAnonymously(window.auth);
                }

                // Listener untuk Autentikasi
                onAuthStateChanged(window.auth, (user) => {
                    window.currentUser = user;
                    window.userId = user ? user.uid : crypto.randomUUID();
                    window.isAuthReady = true;
                    console.log(`Firestore: Auth ready. User ID: ${window.userId}`);
                    
                    // Update Ikon Profil berdasarkan status user
                    updateProfileIcon(); 
                    
                    listenForApps(window.db); 
                    seedInitialData(window.db);
                });

            } catch (error) {
                console.error("Firebase Initialization Error:", error);
            }
        }

        // -----------------------------------------------------
        // 3. LISTENER DATA REAL-TIME DARI FIRESTORE
        // -----------------------------------------------------
        function listenForApps(database) {
            const q = query(collection(database, APPS_COLLECTION));
            
            onSnapshot(q, (snapshot) => {
                window.allAppsAndGames = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                console.log(`Firestore: Fetched ${window.allAppsAndGames.length} items.`);
                
                const activeNavElement = document.querySelector('#bottom-nav-footer > div.text-blue-500');
                const currentNav = activeNavElement ? activeNavElement.id.replace('nav-', '') : 'aplikasi'; 
                
                const activeTabElement = document.querySelector('#top-nav-tabs span.tab-active');
                const currentTab = activeTabElement ? activeTabElement.id.replace('tab-', '') : 'untuk-anda'; 

                updateMainContent(currentNav, currentTab); 
            }, (error) => {
                console.error("Firestore Listener Error:", error);
            });
        }

        // Jalankan inisialisasi saat DOM siap
        document.addEventListener('DOMContentLoaded', initializeAppAndAuth);
        
        // --- LOGIKA Ikon Profil ---
        function updateProfileIcon() {
            const container = document.getElementById('profile-icon-placeholder');
            const user = window.currentUser;
            
            let iconHtml;

            if (user && user.photoURL) {
                // User sudah login dan punya foto profil
                iconHtml = `<img src="${user.photoURL}" alt="Foto Profil" class="w-8 h-8 rounded-full object-cover flex-shrink-0" onerror="this.onerror=null;this.src='https://placehold.co/32x32/1E88E5/ffffff?text=${user.email.charAt(0).toUpperCase()}'">`;
            } else if (user && user.email) {
                // User sudah login (contohnya lewat email/password) tapi tanpa foto, tampilkan inisial
                const initial = user.email.charAt(0).toUpperCase();
                iconHtml = `<div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center font-bold text-sm text-white flex-shrink-0">${initial}</div>`;
            } else {
                // User belum login atau login anonim. Tampilkan ikon manusia default.
                iconHtml = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-text-secondary">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
                    </svg>
                `;
            }
            container.innerHTML = iconHtml;
        }
    </script>
    
    <style>
        /* Mengatur font default dan menerapkan dark mode secara global */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212;
            color: #ffffff;
            overflow-x: hidden; 
        }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background-color: #333; border-radius: 10px; }
        .app-list-item { transition: background-color 0.2s; cursor: pointer; }
        .app-list-item:hover { background-color: #1a1a1a; }
        .tab-active { color: #3b82f6; border-bottom: 2px solid #3b82f6; font-weight: 600; }
        
        /* ------------------------------------- */
        /* CSS UNTUK ANIMASI (Entrance & Scroll) */
        /* ------------------------------------- */
        /* Hapus entrance-fade global agar tidak bergerak saat diam */
        
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(20px);
            /* Kurangi durasi transisi agar lebih cepat */
            transition: opacity 0.4s ease-out, transform 0.4s ease-out; 
        }
        .animate-on-scroll.scrolled-in {
            opacity: 1;
            transform: translateY(0);
        }
        .book-cover-container {
            width: 100px;
            height: 150px; 
            background-color: #1F1F1F;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        .book-title-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
            padding: 8px;
        }
        .category-box {
             background-color: #1a1a1a; 
             transition: all 0.2s; 
             box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .category-box:hover {
             background-color: #2a2a2a;
             transform: translateY(-2px);
             box-shadow: 0 4px 8px rgba(0,0,0,0.7);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#3B82F6', 
                        'bg-dark': '#121212',
                        'card-dark': '#1F1F1F',
                        'text-secondary': '#A0A0A0',
                    }
                }
            }
        }
        
        // --- MOCK DATA UNTUK CAROUSEL, KATEGORI, BUKU ---

        const appBannerMock = [
             { id: 1, type: 'Aplikasi', title: "Berkilau! Swafoto Kulit Cokelat Segar", image: "https://placehold.co/600x250/CCAA88/333333?text=Berakhir+tanggal+11%2F11%2F25", appName: "FaceApp: Editor Wajah" },
             { id: 2, type: 'Aplikasi', title: "Tambahkan Kemeriahan Halloween-mu", image: "https://placehold.co/600x250/1C0F4A/ffffff?text=Tambahkan+Kemeriahan+Halloween", appName: "UpFoto - AI Photo Enhan..." },
        ];
        const gameBannerMock = [
             { id: 1, type: 'Game', title: "Rasakan pertempuran mendebarkan", image: "https://placehold.co/600x250/203040/ffffff?text=Segera+hadir%0A+Crossfire%3A+Legends", appName: "Crossfire: Legends", isComingSoon: true },
             { id: 2, type: 'Game', title: "Sambut Musim Baru", image: "https://placehold.co/600x250/402030/ffffff?text=Sambut+Musim+Baru", appName: "PUBG Mobile" },
        ];
        let currentAppBannerIndex = 0;
        let currentGameBannerIndex = 0;
        let bannerInterval;

        const exploreCategories = [
            { name: 'Aksi', icon: 'üöÅ', color: 'bg-red-500' },
            { name: 'Simulasi', icon: 'üíµ', color: 'bg-green-500' },
            { name: 'Teka-teki', icon: 'üß©', color: 'bg-blue-500' },
            { name: 'Petualangan', icon: 'üß≠', color: 'bg-yellow-500' },
            { name: 'Balapan', icon: 'üèÅ', color: 'bg-purple-500' },
            { name: 'RPG', icon: '‚öîÔ∏è', color: 'bg-pink-500' },
            { name: 'Strategi', icon: 'üõ°Ô∏è', color: 'bg-emerald-500' },
            { name: 'Olahraga', icon: 'üéæ', color: 'bg-orange-500' },
            { name: 'Kartu', icon: 'üÉè', color: 'bg-indigo-500' },
            { name: 'Papan', icon: 'üëë', color: 'bg-lime-500' },
        ];
        
        const exploreAppCategories = [
            { name: 'Hiburan', icon: 'üé¨', color: 'bg-purple-500' },
            { name: 'Sosial', icon: 'üë•', color: 'bg-red-500' },
            { name: 'Bisnis', icon: 'üíº', color: 'bg-blue-500' },
            { name: 'Gaya Hidup', icon: 'üõãÔ∏è', color: 'bg-green-500' },
        ];

        const bookData = {
            'eBook fiksi ilmiah & fantasi': [
                { title: 'Catatan Petual..', author: 'Vovie Kyu', price: '999,00', color: 'bg-gray-700', image: 'https://placehold.co/100x150/555555/ffffff?text=FIKSI' },
                { title: 'Tung Tung Sahur', author: 'Muhammad Adyan', price: '1.110,00', color: 'bg-gray-700', image: 'https://placehold.co/100x150/444444/ffffff?text=FANTA%0AS' },
                { title: 'Anak Panah', author: 'REI K.', price: 'Tanpa biaya', color: 'bg-gray-700', image: 'https://placehold.co/100x150/333333/ffffff?text=ANAK' },
            ],
            'Komik terlaris': [
                { title: 'Mr. Excellent', author: 'Lila', price: '74.925,00', color: 'bg-red-700', image: 'https://placehold.co/100x150/A00000/ffffff?text=LOVE' },
                { title: 'Jika Rasa Itu', author: 'MASDARAIMUNDA', price: '90.576,00', color: 'bg-blue-700', image: 'https://placehold.co/100x150/0000A0/ffffff?text=CINTA' },
                { title: 'Terbali Mimpi', author: 'Lili', price: '40.000,00', color: 'bg-pink-700', image: 'https://placehold.co/100x150/A000A0/ffffff?text=MIMPI' },
            ],
            'eBook bisnis': [
                { title: 'Pemasaran Cerdas', author: 'Joko', price: '85.000,00', color: 'bg-yellow-700', image: 'https://placehold.co/100x150/A0A000/000000?text=BISNIS' },
                { title: 'Manajemen Keu', author: 'Susi', price: '75.000,00', color: 'bg-green-700', image: 'https://placehold.co/100x150/00A000/ffffff?text=KEU' },
            ]
        };
        
        // --- Ikon SVG & Fungsi Pembantu ---
        function AlfitechIcon() { 
            return `<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white bg-blue-500 p-3 rounded-2xl shadow-lg"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>`;
        }
        function StarIcon(isFilled = true) { const color = isFilled ? 'text-yellow-400' : 'text-gray-500'; const fill = isFilled ? 'currentColor' : 'none'; return `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="${fill}" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 ${color}"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>`;}
        function renderRating(score) { let starsHtml = ''; const fullStars = Math.floor(score); for (let i = 0; i < fullStars; i++) starsHtml += StarIcon(true); for (let i = fullStars; i < 5; i++) starsHtml += StarIcon(false); return starsHtml;}
        
        // --- LOGIKA UTAMA NAVIGASI & RENDER ---

        function renderAppListItem(app) {
            // Memberikan class 'animate-on-scroll'
            return `
                <div class="app-list-item flex items-center p-3 sm:p-4 animate-on-scroll">
                    <!-- Ikon/Logo Aplikasi -->
                    <div class="w-12 h-12 ${app.color} rounded-xl flex items-center justify-center mr-4 text-xl text-white font-bold flex-shrink-0">
                        ${app.icon}
                    </div>
                    <div class="flex-grow min-w-0">
                        <p class="font-semibold text-white truncate">${app.name}</p>
                        <div class="flex items-center text-xs sm:text-sm text-text-secondary">
                            <span>${app.publisher}</span>
                            <span class="mx-2">‚Ä¢</span>
                            <span>${app.type === 'game' ? 'Game' : 'Aplikasi'}</span>
                        </div>
                        <div class="flex items-center text-xs sm:text-sm text-text-secondary mt-1">
                            <span class="flex mr-1">${renderRating(app.rating)}</span>
                            <span>${app.rating}</span>
                            <span class="mx-2">‚Ä¢</span>
                            <span>${app.size}</span>
                        </div>
                    </div>
                    <button class="flex-shrink-0 text-white font-medium px-4 py-2 ml-2 rounded-full text-sm ${app.type === 'game' && app.isComingSoon ? 'bg-gray-600' : 'bg-green-600'} hover:bg-green-700 transition duration-150 shadow-md">
                        ${app.isComingSoon ? 'Pradaftar' : 'Install'}
                    </button>
                </div>
            `;
        }

        function renderRecommendedList(title, type) {
            const data = window.allAppsAndGames.filter(item => item.isRecommended && item.type === type);
            if (data.length === 0) return '';
            
            return `
                <div class="mt-6 animate-on-scroll">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-lg font-bold text-white">${title}</h2>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-text-secondary cursor-pointer"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
                    </div>
                    ${data.map(app => renderAppListItem(app)).join('')}
                </div>
            `;
        }
        
        function renderAplikasi(tabName) {
            let banner = appBannerMock[currentAppBannerIndex % appBannerMock.length];
            
            const bannerHtml = `
                <div id="banner-aplikasi" class="relative h-64 bg-cover bg-center rounded-xl overflow-hidden mb-8 shadow-xl banner-transition animate-on-scroll" 
                    style="background-image: url('${banner.image}'); background-size: cover; background-position: center;">
                    <div class="absolute inset-0 bg-black/30 p-4 flex flex-col justify-between">
                        <span class="text-xs bg-red-600/80 w-max px-2 py-0.5 rounded-full font-semibold">Berakhir tanggal 11/11/25</span>
                        
                        <div class="mt-auto">
                             <h2 class="text-xl sm:text-2xl font-bold mb-3">${banner.title}</h2>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-pink-500 rounded-lg flex items-center justify-center text-2xl">üì∏</div>
                                    <div>
                                        <p class="font-semibold">${banner.appName}</p>
                                        <p class="text-xs text-text-secondary">AI Photo Team ‚Ä¢ 3+</p>
                                    </div>
                                </div>
                                <button class="text-white font-medium px-4 py-2 rounded-full text-sm bg-blue-600 hover:bg-blue-700 transition duration-150">
                                    Install
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            let contentHtml = '';
            if (tabName === 'untuk-anda') {
                contentHtml = renderRecommendedList('Disarankan untuk Anda', 'aplikasi');
            } else if (tabName === 'paling-populer') {
                 contentHtml = renderRecommendedList('Aplikasi Populer', 'aplikasi');
            } else if (tabName === 'anak-anak') {
                 contentHtml = `
                    <div class="p-6 bg-card-dark rounded-xl text-text-secondary animate-on-scroll">
                        Konten untuk kategori <span class="font-bold">Anak-anak</span>.
                    </div>
                `;
            } else if (tabName === 'premium') {
                 contentHtml = `
                    <div class="p-6 bg-card-dark rounded-xl text-text-secondary animate-on-scroll">
                        <p class="text-lg font-bold text-white mb-2">Fitur Eksklusif Alfitech Gratis!</p>
                        <p>Dapatkan akses ke semua modul pembelajaran tanpa batas waktu.</p>
                    </div>
                    ${renderRecommendedList('Aplikasi Premium Pilihan', 'aplikasi')}
                `;
            } else {
                 contentHtml = `
                    <div class="p-6 bg-card-dark rounded-xl text-text-secondary animate-on-scroll">
                        Konten untuk tab <span class="font-bold">${tabName}</span>.
                    </div>
                `;
            }
            
            return bannerHtml + contentHtml;
        }

        function renderGame(tabName) {
            let banner = gameBannerMock[currentGameBannerIndex % gameBannerMock.length];
            
            const bannerHtml = `
                <div id="banner-game" class="relative h-64 bg-cover bg-center rounded-xl overflow-hidden mb-8 shadow-xl banner-transition animate-on-scroll" 
                    style="background-image: url('${banner.image}'); background-size: cover; background-position: center;">
                    <div class="absolute inset-0 bg-black/40 p-4 flex flex-col justify-end">
                        ${banner.isComingSoon ? '<span class="text-xs bg-yellow-600/80 w-max px-2 py-0.5 rounded-full font-semibold mb-2">Segera hadir</span>' : ''}
                        
                        <h2 class="text-xl sm:text-2xl font-bold mb-3">${banner.title}</h2>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-green-700 rounded-lg flex items-center justify-center text-2xl">üî´</div>
                                <div>
                                    <p class="font-semibold">${banner.appName}</p>
                                    <p class="text-xs text-text-secondary">Level Infinite ‚Ä¢ 16+</p>
                                </div>
                            </div>
                            <button class="text-white font-medium px-4 py-2 rounded-full text-sm bg-green-600 hover:bg-green-700 transition duration-150">
                                ${banner.isComingSoon ? 'Pradaftar' : 'Install'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            let contentHtml = '';
            if (tabName === 'untuk-anda') {
                contentHtml = renderRecommendedList('Disarankan untuk Anda', 'game');
            } else if (tabName === 'kategori') {
                 const categories = [
                    { name: 'Aksi', icon: '‚öîÔ∏è' }, { name: 'Arcade', icon: 'üëæ' }, 
                    { name: 'Balapan', icon: 'üèÅ' }, { name: 'Edukasi', icon: 'üéì' },
                    { name: 'Kartu', icon: 'üÉè' }, { name: 'Kasino', icon: 'üé≤' },
                    { name: 'Kasual', icon: 'üßò' }, { name: 'Kata', icon: 'üî†' },
                    { name: 'Musik', icon: 'üéµ' },
                 ];
                 contentHtml = `
                    <div class="mt-4 animate-on-scroll">
                        ${categories.map(cat => `
                            <div class="flex items-center py-3 px-2 border-b border-gray-800 hover:bg-gray-800/50 cursor-pointer">
                                <div class="w-8 h-8 flex items-center justify-center text-xl mr-4">${cat.icon}</div>
                                <span class="font-medium">${cat.name}</span>
                            </div>
                        `).join('')}
                    </div>
                 `;
            } else {
                 contentHtml = `
                    <div class="p-6 bg-card-dark rounded-xl text-text-secondary animate-on-scroll">
                        Konten untuk tab <span class="font-bold">${tabName}</span>.
                    </div>
                `;
            }
            
            return bannerHtml + contentHtml;
        }
        
        function renderTelusuri() {
             const gameCategoriesHtml = exploreCategories.map(cat => `
                <div class="category-box p-3 rounded-xl flex flex-col items-center justify-center text-center cursor-pointer">
                    <div class="w-12 h-12 ${cat.color} rounded-lg flex items-center justify-center text-2xl mb-1">${cat.icon}</div>
                    <span class="text-xs font-medium text-white">${cat.name}</span>
                </div>
            `).join('');
            
            const appCategoriesHtml = exploreAppCategories.map(cat => `
                <div class="category-box p-3 rounded-xl flex flex-col items-center justify-center text-center cursor-pointer">
                    <div class="w-12 h-12 ${cat.color} rounded-lg flex items-center justify-center text-2xl mb-1">${cat.icon}</div>
                    <span class="text-xs font-medium text-white">${cat.name}</span>
                </div>
            `).join('');

            return `
                <!-- Telusuri baris 1 (Jelajahi Game) -->
                <div class="mt-4 animate-on-scroll">
                    <h2 class="text-xl font-bold mb-4">Jelajahi game</h2>
                    <div class="grid grid-cols-4 gap-3">
                        ${gameCategoriesHtml}
                    </div>
                </div>
                
                <!-- Telusuri baris 2 (Jelajahi Aplikasi) -->
                <div class="mt-8 animate-on-scroll">
                    <h2 class="text-xl font-bold mb-4">Jelajahi aplikasi</h2>
                    <div class="grid grid-cols-4 gap-3">
                        ${appCategoriesHtml}
                    </div>
                </div>

                <!-- Bersponsor / Disarankan -->
                <div class="mt-8 pt-4 border-t border-gray-800 animate-on-scroll">
                    <h2 class="text-lg font-bold text-white mb-3">Bersponsor ‚Ä¢ Disarankan untuk Anda</h2>
                    ${renderAppListItem({
                        id: 'spons1',
                        name: 'FBS: Keuangan & Pasar Global',
                        publisher: 'FBS Markets ‚Ä¢ Keuangan',
                        rating: 4.5,
                        size: '17 MB',
                        color: 'bg-green-600',
                        type: 'aplikasi',
                        isRecommended: false,
                        icon: 'FBS',
                    })}
                </div>
            `;
        }

        function renderBuku(tabName) {
            let bookSectionsHtml = Object.keys(bookData).map(sectionTitle => {
                const booksHtml = bookData[sectionTitle].map(book => `
                    <div class="flex-shrink-0 w-[120px] mr-4 text-sm text-center">
                         <div class="book-cover-container mx-auto relative ${book.color}" style="background-image: url('${book.image}'); background-size: cover;">
                            <div class="book-title-overlay">
                                <span class="text-xs font-medium text-white">${book.title.split(' ')[0]}</span>
                            </div>
                         </div>
                        <p class="font-semibold mt-2 text-white truncate">${book.title}</p>
                        <p class="text-xs text-text-secondary truncate">${book.author}</p>
                        <p class="text-xs text-green-400 font-bold mt-1">${book.price}</p>
                    </div>
                `).join('');

                return `
                    <div class="mt-8 animate-on-scroll">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-lg font-bold text-white">${sectionTitle}</h2>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500 cursor-pointer"><polyline points="9 18 15 12 9 6"/></svg>
                        </div>
                        <div class="flex overflow-x-auto pb-4 -mx-4 px-4 scrollbar-hide">
                            ${booksHtml}
                        </div>
                    </div>
                `;
            }).join('');

            return bookSectionsHtml;
        }
        
        // --- LOGIKA UTAMA NAVIGASI ---

        function changeBottomNav(navName) {
            document.querySelectorAll('#bottom-nav-footer > div').forEach(item => {
                item.classList.remove('text-blue-500');
                item.classList.add('text-text-secondary');
            });

            const activeItem = document.getElementById('nav-' + navName);
            if (activeItem) {
                activeItem.classList.remove('text-text-secondary');
                activeItem.classList.add('text-blue-500');
            }

            const topNavTabs = document.getElementById('top-nav-tabs');
            topNavTabs.classList.add('hidden'); 

            if (navName === 'aplikasi') {
                topNavTabs.classList.remove('hidden');
                updateTabNames(['Untuk Anda', 'Paling populer', 'Anak-anak', 'Premium', 'Kategori']);
                changeTopTab('untuk-anda', 'aplikasi');
            } else if (navName === 'game') {
                 topNavTabs.classList.remove('hidden');
                 updateTabNames(['Untuk Anda', 'Paling populer', 'Kategori', 'Premium']);
                 changeTopTab('untuk-anda', 'game');
            } else if (navName === 'buku') {
                 topNavTabs.classList.remove('hidden');
                 updateTabNames(['Untuk Anda', 'Terlaris', 'Rilis baru', 'Genre', 'Audiobook']);
                 changeTopTab('untuk-anda', 'buku');
            } else {
                 updateMainContent(navName, 'default');
            }
        }
        
        function updateTabNames(names) {
            const container = document.getElementById('top-nav-tabs');
            container.innerHTML = '';
            names.forEach((name) => {
                const id = name.toLowerCase().replace(/ /g, '-');
                const span = document.createElement('span');
                span.id = `tab-${id}`;
                span.className = `text-text-secondary font-medium hover:text-white cursor-pointer pb-1 whitespace-nowrap text-sm`;
                span.textContent = name;
                container.appendChild(span);
                span.onclick = () => changeTopTab(id, document.querySelector('#bottom-nav-footer > div.text-blue-500')?.id.replace('nav-', ''));
            });
        }

        function changeTopTab(tabName, category) {
            document.querySelectorAll('#top-nav-tabs span').forEach(tab => {
                tab.classList.remove('tab-active', 'text-white');
                tab.classList.add('text-text-secondary');
            });

            const activeTab = document.getElementById('tab-' + tabName);
            if (activeTab) {
                activeTab.classList.add('tab-active');
                activeTab.classList.remove('text-text-secondary');
            }
            
            updateMainContent(category, tabName);
        }

        function updateMainContent(navKey, tabKey) {
            const content = document.getElementById('main-content-section');
            content.innerHTML = ''; 
            document.getElementById('search-input').placeholder = navKey === 'buku' ? 'Telusuri Buku' : 'Telusuri aplikasi & game...';
            
            const bannerPlaceholder = document.getElementById('alfitech-app-banner-placeholder');
            bannerPlaceholder.classList.add('hidden');
            
            if (navKey === 'aplikasi') {
                content.innerHTML = renderAplikasi(tabKey);
            } else if (navKey === 'game') {
                 content.innerHTML = renderGame(tabKey);
            } else if (navKey === 'telusuri') {
                 content.innerHTML = renderTelusuri();
            } else if (navKey === 'buku') {
                 content.innerHTML = renderBuku(tabKey);
            } else {
                 content.innerHTML = `
                    <h2 class="text-xl font-bold mb-4 border-b border-gray-700 pb-2 animate-on-scroll">${navKey.toUpperCase().replace('-', ' ')}</h2>
                    <div class="p-6 bg-card-dark rounded-xl text-text-secondary animate-on-scroll">
                        <p>Konten untuk bagian <span class="font-bold">${navKey.toUpperCase().replace('-', ' ')}</span> sedang dimuat.</p>
                        <p class="mt-2 text-sm italic">Simulasi UI berhasil.</p>
                    </div>
                `;
            }

            // Setelah konten diperbarui, atur ulang observer animasi
            setupIntersectionObserver();
        }

        // --- Logika Carousel Banner ---
        function updateCarouselBanner(type) {
             const bannerElement = document.getElementById(`banner-${type.toLowerCase()}`);
             if (!bannerElement) return;

             const mockData = type === 'Aplikasi' ? appBannerMock : gameBannerMock;
             const indexKey = type === 'Aplikasi' ? 'currentAppBannerIndex' : 'currentGameBannerIndex';
             let currentIndex = window[indexKey];
             
             const nextIndex = (currentIndex + 1) % mockData.length;
             window[indexKey] = nextIndex;
            
            const activeNavElement = document.querySelector('#bottom-nav-footer > div.text-blue-500');
            const currentNav = activeNavElement ? activeNavElement.id.replace('nav-', '') : 'aplikasi'; 
            const activeTabElement = document.querySelector('#top-nav-tabs span.tab-active');
            const currentTab = activeTabElement ? activeTabElement.id.replace('tab-', '') : 'untuk-anda'; 

            if (currentNav.toLowerCase() === type.toLowerCase()) {
                 updateMainContent(currentNav, currentTab);
            }
        }
        
        function startBannerCarousel() {
            // Animasi banner Aplikasi (481001.jpg/480967.jpg)
            updateCarouselBanner('Aplikasi'); 
            // Animasi banner Game (481002.jpg)
            updateCarouselBanner('Game'); 

            if (bannerInterval) {
                 clearInterval(bannerInterval);
            }
            bannerInterval = setInterval(() => {
                // HANYA jalankan jika user berada di tab Aplikasi atau Game
                const activeNavElement = document.querySelector('#bottom-nav-footer > div.text-blue-500');
                const currentNav = activeNavElement ? activeNavElement.id.replace('nav-', '') : ''; 

                if (currentNav === 'aplikasi') {
                    updateCarouselBanner('Aplikasi');
                } else if (currentNav === 'game') {
                    updateCarouselBanner('Game');
                }

            }, 5000); 
        }
        
        // --- Logika Intersection Observer ---
        let observer;

        function setupIntersectionObserver() {
            // Hapus observer lama
            if (observer) {
                observer.disconnect();
            }
            
            const elements = document.querySelectorAll('.animate-on-scroll');
            
            observer = new IntersectionObserver((entries, obs) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const delay = entry.target.dataset.scrollDelay || 0;
                        setTimeout(() => {
                             entry.target.classList.add('scrolled-in');
                             // Hapus dari observasi setelah animasi berjalan
                             obs.unobserve(entry.target); 
                        }, delay);
                    }
                });
            }, {
                rootMargin: '0px',
                threshold: 0.1
            });

            elements.forEach((el, index) => {
                 // Atur delay untuk efek berjenjang
                 el.dataset.scrollDelay = index * 50; 
                 observer.observe(el);
                 
                 // Secara default, elemen yang sudah ada di viewport saat pertama kali dimuat harus langsung dianimasikan
                 const rect = el.getBoundingClientRect();
                 if (rect.top < window.innerHeight && rect.bottom > 0) {
                     el.classList.add('scrolled-in');
                     observer.unobserve(el);
                 }
            });
        }

        // --- INISIALISASI ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('alfitech-icon-placeholder').innerHTML = AlfitechIcon();
            
            // Panggil updateProfileIcon() lagi setelah DOM siap dan setelah auth, memastikan ikon benar
            updateProfileIcon(); 
            
            changeBottomNav('aplikasi'); 
            
            startBannerCarousel();
            // setupIntersectionObserver dipanggil di dalam updateMainContent
        });

    </script>
</head>
<body class="min-h-screen">

    <div id="main-app-container" class="max-w-xl mx-auto pb-20"> <!-- Hapus class animasi dari sini -->

        <!-- HEADER/SEARCH BAR -->
        <header class="sticky top-0 bg-bg-dark/95 backdrop-blur-sm z-10 p-4 border-b border-gray-800 animate-on-scroll">
            <div class="flex items-center justify-between">
                <!-- Search Box -->
                <div class="flex items-center bg-gray-800 rounded-full p-2 flex-grow mr-4 shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-text-secondary ml-1 flex-shrink-0"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                    <input type="text" id="search-input" placeholder="Telusuri aplikasi & game..." class="bg-transparent text-white ml-2 focus:outline-none w-full placeholder-text-secondary text-base">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-text-secondary mr-1 cursor-pointer"><path d="M12 21c-1.33 0-2.59-0.52-3.54-1.46S7 17.33 7 16V8h10v8c0 1.33-0.52 2.59-1.46 3.54S13.33 21 12 21z"/><line x1="12" y1="3" x2="12" y2="4"/></svg>
                </div>
                <!-- Ikon Profil (Diperbarui oleh JS) -->
                <div id="profile-icon-placeholder" class="cursor-pointer">
                    <!-- Default: Ikon Manusia -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-text-secondary">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
                    </svg>
                </div>
            </div>
            
            <!-- Sub-Navigation Tabs -->
            <div id="top-nav-tabs" class="flex space-x-6 overflow-x-auto mt-4 pb-1"> 
                 <!-- Tabs akan diisi oleh JS -->
            </div>
        </header>

        <!-- Bagian Konten Dinamis -->
        <main class="p-4">
            
            <!-- Simulasi Detail Aplikasi Utama (Tetap ditampilkan, diberi animasi) -->
            <div id="alfitech-app-banner-placeholder" class="hidden">
                <div class="flex items-start mb-6 animate-on-scroll">
                    <!-- Ikon Alfitech -->
                    <div id="alfitech-icon-placeholder" class="mr-4 flex-shrink-0"></div>
                    <div class="flex-grow min-w-0">
                        <h1 class="text-2xl sm:text-3xl font-bold truncate">Alfitech App</h1>
                        <p class="text-base sm:text-lg text-text-secondary mb-2 truncate">Alfitech Technology Co.</p>
                        <div class="flex items-center space-x-3 text-sm">
                            <div class="border border-gray-600 px-2 py-0.5 rounded-md text-text-secondary font-medium flex-shrink-0">3+</div>
                            <div class="flex items-center flex-shrink-0">
                                <span class="flex mr-1">${renderRating(4.8)}</span>
                                <span class="font-semibold text-white">4.8</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tombol Install & Info File -->
                <div class="grid grid-cols-3 gap-4 bg-card-dark p-4 rounded-xl mb-6 shadow-lg divide-x divide-gray-700 animate-on-scroll">
                    <div class="text-center"><p class="text-xl font-bold">45 MB</p><p class="text-sm text-text-secondary">Ukuran</p></div>
                    <div class="text-center"><p class="text-xl font-bold">4.8</p><p class="text-sm text-text-secondary">Rating</p></div>
                    <div class="col-span-1 text-center">
                        <button class="inline-flex items-center justify-center bg-green-600 text-white font-bold py-2 px-6 rounded-full text-lg w-full sm:w-auto shadow-lg hover:bg-green-700 transition duration-200">
                           Install
                        </button>
                    </div>
                </div>
            </div>


            <!-- Area Konten Dinamis -->
            <div id="main-content-section" class="pb-4">
                 <!-- Konten akan dirender di sini -->
            </div>

        </main>

        <!-- FOOTER/BOTTOM NAVIGATION BAR -->
        <footer class="fixed bottom-0 left-0 right-0 max-w-xl mx-auto bg-bg-dark border-t border-gray-800 shadow-2xl z-20">
            <div id="bottom-nav-footer" class="flex justify-around items-center h-16">
                
                <!-- Game Icon -->
                <div id="nav-game" onclick="changeBottomNav('game')" class="flex flex-col items-center text-text-secondary hover:text-white cursor-pointer transition duration-150">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 21a9 9 0 0 0 9-9c0-6.24-5.28-7.98-9-7.98C6.9 4.02 2 5.91 2 12a9 9 0 0 0 9 9z"/><path d="M15 15l-1-1m-4 0l-1 1m-1-4l1-1m4 0l1 1"/></svg>
                    <span class="text-xs mt-1">Game</span>
                </div>

                <!-- Aplikasi Icon -->
                <div id="nav-aplikasi" onclick="changeBottomNav('aplikasi')" class="flex flex-col items-center text-blue-500 hover:text-white cursor-pointer transition duration-150">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect width="7" height="7" x="3" y="3" rx="1" fill="none" stroke="currentColor"/><rect width="7" height="7" x="14" y="3" rx="1" fill="none" stroke="currentColor"/><rect width="7" height="7" x="14" y="14" rx="1" fill="none" stroke="currentColor"/><rect width="7" height="7" x="3" y="14" rx="1" fill="none" stroke="currentColor"/>
                    </svg>
                    <span class="text-xs mt-1">Aplikasi</span>
                </div>

                <!-- Telusuri Icon -->
                <div id="nav-telusuri" onclick="changeBottomNav('telusuri')" class="flex flex-col items-center text-text-secondary hover:text-white cursor-pointer transition duration-150">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                    <span class="text-xs mt-1">Telusuri</span>
                </div>

                <!-- Buku Icon -->
                <div id="nav-buku" onclick="changeBottomNav('buku')" class="flex flex-col items-center text-text-secondary hover:text-white cursor-pointer transition duration-150">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5V15a2.5 2.5 0 0 1 5 0v4.5"/><path d="M12 14.5V9a2.5 2.5 0 0 1 5 0v5.5"/><path d="M4 19.5a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2Z"/></svg>
                    <span class="text-xs mt-1">Buku</span>
                </div>

                <!-- Lainnya/Anda Icon -->
                <div id="nav-anda" onclick="changeBottomNav('anda')" class="flex flex-col items-center text-text-secondary hover:text-white cursor-pointer transition duration-150">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    <span class="text-xs mt-1">Anda</span>
                </div>

            </div>
        </footer>

    </div>
</body>
</html>

